// ==UserScript==
// @name       changjiang-ai-answer
// @namespace  wibus/changjiang-ai-answer
// @version    0.0.0
// @icon       https://vitejs.dev/logo.svg
// @match      https://changjiang.yuketang.cn/*
// @match      https://changjiang-exam.yuketang.cn/*
// @match      https://www.doubao.com/*
// @require    https://cdn.jsdelivr.net/npm/systemjs@6.15.1/dist/system.min.js
// @require    https://cdn.jsdelivr.net/npm/systemjs@6.15.1/dist/extras/named-register.min.js
// @require    data:application/javascript,%3B(typeof%20System!%3D'undefined')%26%26(System%3Dnew%20System.constructor())%3B
// @grant      GM_addStyle
// @grant      unsafeWindow
// ==/UserScript==


System.register("./__entry.js", ['./wait-CYghtssh-DEyvWMVm.js'], (function (exports, module) {
  'use strict';
  var C$1, T$1, R$1, v$1, j$1;
  return {
    setters: [module => {
      C$1 = module.C;
      T$1 = module.T;
      R$1 = module.R;
      v$1 = module.v;
      j$1 = module.j;
    }],
    execute: (async function () {

      const d=new Set;const Ft = async e=>{d.has(e)||(d.add(e),(t=>{typeof GM_addStyle=="function"?GM_addStyle(t):document.head.appendChild(document.createElement("style")).append(t);})(e));};

      const Zt=(function(){const t=typeof document<"u"&&document.createElement("link").relList;return t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"})(),Vt=function(n){return "/"+n},it={},Kt=function(t,e,o){let r=Promise.resolve();if(e&&e.length>0){let c=function(d){return Promise.all(d.map(u=>Promise.resolve(u).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),i=a?.nonce||a?.getAttribute("nonce");r=c(e.map(d=>{if(d=Vt(d),d in it)return;it[d]=true;const u=d.endsWith(".css"),l=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${l}`))return;const m=document.createElement("link");if(m.rel=u?"stylesheet":Zt,u||(m.as="script"),m.crossOrigin="",m.href=d,i&&m.setAttribute("nonce",i),document.head.appendChild(m),u)return new Promise((p,b)=>{m.addEventListener("load",p),m.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${d}`)));})}));}function s(a){const i=new Event("vite:preloadError",{cancelable:true});if(i.payload=a,window.dispatchEvent(i),!i.defaultPrevented)throw a}return r.then(a=>{for(const i of a||[])i.status==="rejected"&&s(i.reason);return t().catch(s)})},Xt=':root{--cjai-bg: rgba(255, 255, 255, .8);--cjai-bg-muted: rgba(255, 255, 255, .9);--cjai-border: rgba(0, 0, 0, .1);--cjai-ink: #111;--cjai-ink-muted: #666;--cjai-shadow: 0 8px 30px rgba(0, 0, 0, .12);--cjai-radius: 12px;--cjai-accent: #111;--cjai-danger: #e11d48;--cjai-primary: #111}.cjai-panel{position:fixed;inset:auto auto 24px 24px;min-width:260px;min-height:120px;width:360px;height:240px;z-index:10;color:var(--cjai-ink);background:var(--cjai-bg);-webkit-backdrop-filter:saturate(180%) blur(12px);backdrop-filter:saturate(180%) blur(12px);border:1px solid var(--cjai-border);border-radius:var(--cjai-radius);box-shadow:var(--cjai-shadow);overflow:hidden;-webkit-user-select:none;user-select:none;font:13px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}.cjai-panel *{box-sizing:border-box}.cjai-panel__header{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-bottom:1px solid var(--cjai-border);cursor:move;background:var(--cjai-bg-muted)}.cjai-panel__title{font-weight:600;letter-spacing:.2px}.cjai-panel__controls{display:flex;gap:6px}.cjai-btn{appearance:none;border:1px solid var(--cjai-border);background:transparent;color:var(--cjai-ink);padding:6px 10px;border-radius:8px;cursor:pointer;transition:all .12s ease}.cjai-btn:hover{border-color:var(--cjai-ink)}.cjai-btn--primary{background:var(--cjai-accent);color:#fff;border-color:transparent}.cjai-btn--primary:hover{filter:brightness(1.05)}.cjai-btn--danger{background:#e11d48;color:#fff;border-color:transparent}.cjai-btn--danger:hover{filter:brightness(1.05)}.cjai-btn[disabled]{opacity:.5;cursor:not-allowed}.cjai-chip{font-size:10px;padding:2px 6px;background:var(--cjai-bg-muted);border:1px solid var(--cjai-border);border-radius:999px;color:var(--cjai-ink-muted);margin-left:6px}.cjai-panel__body{display:flex;flex-direction:column;gap:8px;padding:8px;height:calc(100% - 40px)}.cjai-tabs{display:flex;gap:6px;padding:4px;border:1px solid var(--cjai-border);border-radius:8px;background:var(--cjai-bg-muted)}.cjai-tab{appearance:none;border:none;background:transparent;color:var(--cjai-ink-muted);padding:6px 10px;border-radius:6px;cursor:pointer;font-weight:600}.cjai-tab[aria-selected=true]{background:var(--cjai-bg);color:var(--cjai-ink);box-shadow:inset 0 0 0 1px var(--cjai-border)}.cjai-panel__content{position:relative;flex:1;min-height:0;border:1px solid var(--cjai-border);border-radius:8px;overflow:hidden;background:var(--cjai-bg)}.cjai-tabpane{position:absolute;inset:0;overflow:auto;display:none;background:#fff}.cjai-tabpane[data-active=true]{display:block}.cjai-controls{display:flex;flex-direction:column;gap:8px;height:100%}.cjai-controls__content{padding:8px 2px 8px 8px;flex:1;min-height:0;overflow:auto}.cjai-controls__actions{flex:0 0 auto;display:flex;flex-wrap:wrap;gap:8px;padding:8px;border-top:1px solid var(--cjai-border);background:var(--cjai-bg-muted);-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);position:sticky;bottom:0}.cjai-doc{white-space:pre-wrap;word-break:break-word;line-height:1.6}.cjai-section{border:1px solid var(--cjai-border);border-radius:8px;padding:10px;background:var(--cjai-bg)}.cjai-section+.cjai-section{margin-top:8px}.cjai-section__title{font-weight:600;margin-bottom:8px}.cjai-section__description{font-size:12px;color:var(--cjai-ink-muted);margin-bottom:8px}.cjai-rows{display:flex;flex-direction:column;gap:8px;margin-top:4px}.cjai-row{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:10px 8px;border:1px solid var(--cjai-border);border-radius:8px;background:var(--cjai-bg);margin-bottom:8px}.cjai-row--clickable{cursor:pointer}.cjai-row--clickable:hover{background:var(--cjai-bg-muted)}.cjai-check{display:inline-flex;align-items:center;gap:8px;-webkit-user-select:none;user-select:none}.cjai-check input{appearance:none;width:16px;height:16px;border:1px solid var(--cjai-border);border-radius:4px;background:#fff;display:inline-block;position:relative;transition:all .12s ease;outline:none}.cjai-check input:hover{border-color:var(--cjai-ink)}.cjai-check input:focus{box-shadow:0 0 0 3px #0000000f}.cjai-check input:checked{background:var(--cjai-accent);border-color:var(--cjai-accent)}.cjai-check input:checked:after{content:"";position:absolute;left:4px;top:1px;width:4px;height:8px;border:2px solid #fff;border-top:none;border-left:none;transform:rotate(45deg)}.cjai-row__label{color:var(--cjai-ink);font-weight:500}.cjai-switch{position:relative;width:44px;height:24px}.cjai-switch input{opacity:0;width:0;height:0}.cjai-switch__slider{position:absolute;inset:0;background:#e5e7eb;border-radius:999px;transition:all .15s ease;box-shadow:inset 0 0 0 1px var(--cjai-border)}.cjai-switch__slider:after{content:"";position:absolute;left:3px;top:3px;width:18px;height:18px;background:#fff;border-radius:50%;transition:all .15s ease;box-shadow:0 1px 2px #0000001a}.cjai-switch input:checked+.cjai-switch__slider{background:var(--cjai-accent);box-shadow:none}.cjai-switch input:checked+.cjai-switch__slider:after{transform:translate(20px)}.cjai-info-item{display:flex;justify-content:space-between;align-items:center;gap:8px;padding:6px 0;border-bottom:1px dashed rgba(0,0,0,.06)}.cjai-info-item:last-child{border-bottom:none}.cjai-info-key{color:var(--cjai-ink-muted)}.cjai-info-value{font-weight:600}.cjai-resize{position:absolute;right:6px;bottom:6px;width:14px;height:14px;cursor:nwse-resize;opacity:.6}.cjai-resize:after{content:"";position:absolute;right:2px;bottom:2px;width:10px;height:10px;border-right:2px solid var(--cjai-border);border-bottom:2px solid var(--cjai-border);border-radius:0 0 3px}.cjai-panel--collapsed{height:auto!important;width:auto!important;min-width:48px;min-height:32px}.cjai-panel--collapsed .cjai-panel__body,.cjai-panel--collapsed .cjai-resize{display:none}.cjai-panel--collapsed .cjai-panel__header{cursor:move;padding:6px 8px}.cjai-panel--collapsed .cjai-panel__title{font-size:12px}.cjai-toast-host{position:absolute;left:50%;bottom:52px;transform:translate(-50%);pointer-events:none;display:flex;flex-direction:column;align-items:center;gap:6px;z-index:50}.cjai-toast{pointer-events:auto;background:var(--cjai-bg-muted);color:var(--cjai-ink);border:1px solid var(--cjai-border);border-radius:8px;padding:8px 12px;box-shadow:var(--cjai-shadow);max-width:420px;-webkit-backdrop-filter:saturate(180%) blur(10px);backdrop-filter:saturate(180%) blur(10px);opacity:0;transform:translateY(6px) scale(.98);transition:all .2s ease;font-weight:500}.cjai-toast[data-show=true]{opacity:1;transform:translateY(0) scale(1)}.cjai-toast--success{border-color:#10b98166}.cjai-toast--warn{border-color:#f59e0b66}.cjai-toast--error{border-color:#ef444473}';Ft(Xt);const Qt=".exam-aside .el-scrollbar__view .aside-body",Yt=".exam-aside",Ot=".subject-item.J_order[data-order]",Gt=".subject-item.J_order.active",te=".aside-body--progress";function D(){return document.querySelector(Qt)||document.querySelector(Yt)}function z(n){const t=n??D();return t?Array.from(t.querySelectorAll(Ot)):[]}function ee(n){if(!n)return null;const t=n.getAttribute("data-order")||"",e=parseInt(t,10);if(!Number.isNaN(e))return e;const r=(n.textContent||"").trim().match(/\d+/);return r?parseInt(r[0],10):null}function ct(n){const t=n??D();return t?t.querySelector(Gt):null}function ne(n){const t=D();if(!t)return null;const e=t.querySelector(te);if(!e)return null;const r=(e.textContent||"").replace(/\u00A0/g," ").trim().match(/\/(\s*\d+)\s*题?/);if(r){const s=parseInt(r[1].trim(),10);if(!Number.isNaN(s))return s}return null}function oe(n,t=true){try{n.scrollIntoView({block:"center",behavior:t?"smooth":"auto"});}catch{n.scrollIntoView();}}function re(n,t){const e=D();if(!e)return  false;const o=e.querySelector(`${Ot}[data-order="${n}"]`);return o?(oe(o,t?.smooth!==false),o.click(),C$1.info("goTo",n),true):false}async function se(n={}){const{timeoutMs:t=1e4,intervalMs:e=300,useObserver:o=true,signal:r}=n,s=D();if(s&&z(s).length>0)return s;let a=false,i=null,c=null,d=null;const u=(l,m)=>{a||(a=true,i!==null&&window.clearInterval(i),c!==null&&window.clearTimeout(c),d&&d.disconnect(),m(l));};return new Promise(l=>{const m=()=>{const p=D();p&&z(p).length>0&&u(p,l);};if(i=window.setInterval(m,e),o&&typeof MutationObserver<"u"){const p=document.body;d=new MutationObserver(()=>m()),d.observe(p,{childList:true,subtree:true});}if(c=window.setTimeout(()=>u(null,l),t),r){const p=()=>u(null,l);r.addEventListener("abort",p,{once:true});}})}const v={container:D,list:()=>z(),currentEl:ct,current:()=>ee(ct()),total:()=>ne()??(z().length||null),goTo:re,next:n=>{const t=v.total(),e=v.current(),o=e?e+1:1;return t&&o>t?n?.loop?v.goTo(1,n):false:v.goTo(o,n)},prev:n=>{const t=v.total(),e=v.current(),o=e?e-1:1;return o<1?n?.loop&&t?v.goTo(t,n):false:v.goTo(o,n)},first:n=>v.goTo(1,n),last:n=>{const t=v.total();return t?v.goTo(t,n):false},wait:se},lt="#app > div.viewContainer > div > div > div.container > div > div > div.container-problem > div.problem-fixedbar > div > div:nth-child(2) > div > ul > li > span > button",dt="#app > div.viewContainer > div > div > div.container > div > div > div.container-problem > div.el-scrollbar > div.el-scrollbar__wrap.el-scrollbar__wrap--hidden-default > div > div",ae=[{domain:"main",hostMatch:n=>/(^|\.)changjiang\.yuketang\.cn$/.test(n),flags:{actionPanel:true,notepad:true,prompt:true,capture:true,orderNav:true,submitHotkey:true,questionExport:false,doubaoBridge:true,autoWatch:true},selectors:{submitButton:lt,questionContainerExact:dt}},{domain:"doubao",hostMatch:n=>/(^|\.)doubao\.com$/.test(n),flags:{actionPanel:false,notepad:false,prompt:false,capture:false,orderNav:false,submitHotkey:false,questionExport:false,doubaoBridge:true,autoWatch:false}},{domain:"exam",hostMatch:n=>/(^|\.)changjiang-exam\.yuketang\.cn$/.test(n),flags:{actionPanel:true,notepad:true,prompt:true,capture:false,orderNav:false,submitHotkey:true,questionExport:true,doubaoBridge:false,autoWatch:false},selectors:{submitButton:lt,questionContainerExact:dt}}];function It(n=location.hostname){return ae.find(e=>e.hostMatch(n))||{domain:"unknown",hostMatch:()=>true,flags:{actionPanel:true,notepad:true,prompt:true,capture:false,orderNav:false,submitHotkey:false,questionExport:false,doubaoBridge:false,autoWatch:false}}}const ie="CJ_AI_FLAGS_";function ce(n){try{const t=`${ie}${n.domain}`,e=localStorage.getItem(t);if(!e)return n;const o=JSON.parse(e);return {...n,...o,flags:{...n.flags,...o.flags||{}},selectors:{...n.selectors,...o.selectors||{}}}}catch{return n}}function R(n=location.hostname){return ce(It(n))}function j(n){return !!R().flags[n]}function ut(){const n=R().selectors?.questionContainerExact||"#app > div.viewContainer > div > div > div.container > div > div > div.container-problem > div.el-scrollbar > div.el-scrollbar__wrap.el-scrollbar__wrap--hidden-default > div > div",t=/\(\s*\d+(?:\.\d+)?\s*分\s*\)/,e=/\b\d+[\.、]?[\u3001、\s]*[\u4e00-\u9fa5]{1,6}题\b/,o=p=>(p??"").replace(/\u00A0/g," ").replace(/\s+/g," ").trim(),r=p=>{const b=o(p);return t.test(b)||e.test(b)},s=p=>{const b=p.getBoundingClientRect(),h=window.innerHeight||document.documentElement.clientHeight,S=window.innerWidth||document.documentElement.clientWidth,k=b.top<h&&b.bottom>0,x=b.left<S&&b.right>0;return k&&x},a=p=>{if(p.length===0)return null;const b=p.map(h=>({el:h,top:Math.abs(h.getBoundingClientRect().top)}));return b.sort((h,S)=>h.top-S.top),b[0].el},i=document.querySelector(".container-problem .el-scrollbar__view")||document.querySelector(".container-problem")||null,d=Array.from((i??document).querySelectorAll('.subject-item .item-type, .item-type, [class*="item-type"]')).filter(p=>r(p.textContent||"")).map(p=>p.closest(".subject-item")).filter(p=>!!p);if(d.length>0){const p=d.filter(s);return p.length>0?a(p):a(d)}const u=Array.from((i??document).querySelectorAll(".subject-item"));if(u.length>0){const p=u.filter(s);return p.length>0?a(p):u[0]??null}const l=document.querySelector(n);if(l)return l;const m=document.querySelector("#app .container-problem .el-scrollbar__wrap")||document.querySelector(".viewContainer .container-problem")||document.querySelector("#app");if(m){const b=Array.from(m.querySelectorAll(':scope > div, :scope > * > div, [class*="subject"], [class*="item"]')).filter(h=>h.childElementCount>0).filter(h=>h.getBoundingClientRect().height>40).filter(h=>/subject|item/i.test(h.className));if(b.length>0){const h=b.filter(s);return h.length>0?a(h):b[0]??null}}return null}async function Lt(n={}){const{timeoutMs:t=1e4,intervalMs:e=300,useObserver:o=true,signal:r}=n,s=ut();if(s)return s;C$1.info("waitForQuestionElement: initial check did not find the element, start waiting...");let a=false,i=null,c=null,d=null;const u=(l,m)=>{a||(a=true,i!==null&&window.clearInterval(i),c!==null&&window.clearTimeout(c),d&&d.disconnect(),m(l));};return new Promise(l=>{const m=()=>{const p=ut();p&&u(p,l);};if(i=window.setInterval(m,e),o&&typeof MutationObserver<"u"){const p=document.querySelector(".container-problem .el-scrollbar__view")||document.querySelector(".container-problem")||document.body;d=new MutationObserver(()=>m()),d.observe(p,{childList:true,subtree:true});}if(c=window.setTimeout(()=>u(null,l),t),r){const p=()=>u(null,l);r.addEventListener("abort",p,{once:true});}})}let Pt=null;function le(){return Pt}function qt(n,t){return new Promise(e=>{if(document.getElementById(n)){e(true);return}const r=document.createElement("script");r.id=n,r.src=t,r.async=true,r.onload=()=>e(true),r.onerror=()=>e(false),document.head.appendChild(r);})}async function de(){const n=globalThis;if(typeof window.html2canvas=="function")return  true;if(n&&typeof n.html2canvas=="function")return window.html2canvas=n.html2canvas,true;if(typeof unsafeWindow<"u"&&typeof unsafeWindow.html2canvas=="function")return window.html2canvas=unsafeWindow.html2canvas,true;await qt("cjai-html2canvas","https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js")||C$1.warn("Failed to inject html2canvas from CDN");for(let e=0;e<50;e++){if(typeof window.html2canvas=="function")return  true;if(n&&typeof n.html2canvas=="function")return window.html2canvas=n.html2canvas,true;if(typeof unsafeWindow<"u"&&typeof unsafeWindow.html2canvas=="function")return window.html2canvas=unsafeWindow.html2canvas,true;await new Promise(o=>setTimeout(o,100));}return C$1.warn("html2canvas is not available"),false}async function ue(n,t={}){if(!await de()||!window.html2canvas)return null;const o=t.scale??(window.devicePixelRatio||1),r=t.backgroundColor??"#fff";try{return await window.html2canvas(n,{backgroundColor:r,scale:o,useCORS:!0,logging:!1,allowTaint:!0,windowWidth:document.documentElement.clientWidth,windowHeight:document.documentElement.clientHeight})}catch(s){return Pt=s,C$1.error("captureElementToCanvas failed",s),null}}async function pe(n,t={}){const e=await ue(n,t);return e?new Promise(o=>{e.toBlob(r=>o(r),"image/png");}):null}async function fe(){const n=globalThis;if(window.JSZip)return  true;if(n&&n.JSZip)return window.JSZip=n.JSZip,true;if(typeof unsafeWindow<"u"&&unsafeWindow.JSZip)return window.JSZip=unsafeWindow.JSZip,true;await qt("cjai-jszip","https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js")||C$1.warn("Failed to inject JSZip from CDN");for(let e=0;e<50;e++){if(window.JSZip)return  true;if(n&&n.JSZip)return window.JSZip=n.JSZip,true;if(typeof unsafeWindow<"u"&&unsafeWindow.JSZip)return window.JSZip=unsafeWindow.JSZip,true;await new Promise(o=>setTimeout(o,100));}return !!window.JSZip}async function me(n,t="captures.zip"){if(!await fe()||!window.JSZip)return  false;const o=new window.JSZip;for(const a of n)o.file(a.name,a.blob);const r=await o.generateAsync({type:"blob"}),s=URL.createObjectURL(r);try{const a=document.createElement("a");return a.href=s,a.download=t,document.body.appendChild(a),a.click(),a.remove(),!0}finally{setTimeout(()=>URL.revokeObjectURL(s),8e3);}}async function he(n,t=150){for(const e of n){const o=URL.createObjectURL(e.blob),r=document.createElement("a");r.href=o,r.download=e.name,document.body.appendChild(r),r.click(),r.remove(),setTimeout(()=>URL.revokeObjectURL(o),8e3),t&&await new Promise(s=>setTimeout(s,t));}}async function be(n){if(!("showDirectoryPicker"in window))return  false;try{const e=await window.showDirectoryPicker();for(const o of n){const s=await(await e.getFileHandle(o.name,{create:!0})).createWritable();await s.write(o.blob),await s.close();}return !0}catch{return  false}}class ye{constructor(t={}){this.options=t;}abort=new AbortController;running=false;stop(){this.running&&(this.abort.abort(),this.abort=new AbortController,this.running=false,C$1.warn("Capture stopped"));}async captureOne(t){if(!v.goTo(t,{smooth:false}))return C$1.warn("goTo failed",t),false;await R$1(()=>v.current()===t,{timeoutMs:8e3,intervalMs:100})||C$1.warn("Wait active timed out for order",t),(this.options.delayAfterNavigateMs??200)&&await v$1(this.options.delayAfterNavigateMs??200);const o=await Lt({timeoutMs:12e3,intervalMs:250,signal:this.abort.signal});if(!o)return C$1.error("Question element not found for order",t),false;const r=v.total(),s=this.options.filenamePattern?this.options.filenamePattern(t,r):`question-${String(t).padStart(3,"0")}.png`;try{o.scrollIntoView({block:"nearest",behavior:"instant"});}catch{}const a=await pe(o,this.options.screenshot);if(!a){const c=o.getBoundingClientRect(),d={reason:le(),html2canvas:typeof window.html2canvas,rect:{x:Math.round(c.x),y:Math.round(c.y),w:Math.round(c.width),h:Math.round(c.height)},offset:{w:o.offsetWidth,h:o.offsetHeight},visibility:getComputedStyle(o).visibility,display:getComputedStyle(o).display,inDOM:document.contains(o)};return C$1.error("Capture failed for order",t,d),this.options.onCapture?.({order:t,total:r??null,filename:s,blob:null,url:null,status:"error",createdAt:Date.now(),selected:false,error:JSON.stringify(d)}),false}const i={order:t,total:r??null,filename:s,blob:a,url:null,status:"ok",createdAt:Date.now(),selected:true};return this.options.onCapture?.(i),C$1.success("Captured",s),true}async captureAllFromCurrent(){if(this.running){C$1.warn("Capture already running");return}this.running=true;try{await v.wait({timeoutMs:15e3,intervalMs:300,signal:this.abort.signal});const t=v.total(),e=v.current()??1;if(!t||t<=0){C$1.error("Total questions not detected");return}C$1.banner("Capture",`from ${e} to ${t}`);for(let o=e;o<=t&&!this.abort.signal.aborted;o++)await this.captureOne(o)||C$1.warn("Capture failed at order",o);C$1.success("Capture finished");}finally{this.running=false;}}}const ge={id:"cjai-action-panel",title:"Action Panel",dock:"bottom-right",resizable:true,draggable:true,collapsed:false,zIndex:999999,injectStyles:true},pt="cjai-action-panel-style";function we(){let n=document.getElementById(pt);n||(n=document.createElement("style"),n.id=pt,document.head.appendChild(n)),n.textContent=`
  
  `;}function I(n,t,e){return Math.max(t,Math.min(e,n))}function ft(n){return `${n}:state`}class xe{root;header;titleEl;tabsBar;contentWrap;contentEl;actionsEl;resizeHandle;opts;unsub=[];dragging=false;dragOffset={x:0,y:0};resizing=false;resizeStart={w:0,h:0,x:0,y:0};panes=new Map;toastHost;constructor(t={}){const e={...ge,...t};this.opts=e,e.injectStyles&&we();const o=document.createElement("div");o.className="cjai-panel",o.style.zIndex=String(e.zIndex),o.style.position="fixed";const r=document.createElement("div");r.className="cjai-panel__header";const s=document.createElement("div");s.className="cjai-panel__title",s.textContent=e.title||"Action Panel";const a=document.createElement("div");a.className="cjai-panel__controls";const i=document.createElement("button");i.className="cjai-btn",i.title="Collapse / Expand",i.textContent="—";const c=document.createElement("button");c.className="cjai-btn",c.title="Close",c.textContent="×",a.append(i,c),r.append(s,a);const d=document.createElement("div");d.className="cjai-panel__body";const u=document.createElement("div");u.className="cjai-tabs";const l=document.createElement("div");l.className="cjai-panel__content";const m=document.createElement("div");m.className="cjai-tabpane cjai-controls",m.dataset.active="true";const p=document.createElement("div");p.className="cjai-controls__content";const b=document.createElement("div");b.className="cjai-controls__actions",m.append(p,b),l.append(m),d.append(u,l);const h=document.createElement("div");h.className="cjai-resize";const S=document.createElement("div");S.className="cjai-toast-host",o.append(r,d,h,S),this.root=o,this.header=r,this.titleEl=s,this.tabsBar=u,this.contentWrap=l,this.contentEl=p,this.actionsEl=b,this.resizeHandle=h,this.toastHost=S,this.addTab({id:"controls",label:"Controls",content:m,select:true}),e.draggable&&this.enableDragging(),e.resizable&&this.enableResizing(),i.addEventListener("click",()=>this.setCollapsed(!this.isCollapsed())),c.addEventListener("click",()=>this.destroy()),this.restoreState(),t.position&&this.setPosition(t.position.x,t.position.y),t.size&&this.setSize(t.size.width,t.size.height),t.collapsed!=null&&this.setCollapsed(!!t.collapsed),(e.mount||document.body).appendChild(o);}saveState(){try{const t=this.root.getBoundingClientRect(),e={x:t.left,y:t.top,w:t.width,h:t.height,collapsed:this.isCollapsed()};localStorage.setItem(ft(this.opts.id),JSON.stringify(e));}catch{}}restoreState(){const t=ft(this.opts.id);let e=null;try{const d=localStorage.getItem(t);d&&(e=JSON.parse(d));}catch{}const o=window.innerWidth,r=window.innerHeight;let{x:s,y:a}=e??{x:NaN,y:NaN},{w:i,h:c}=e??{w:NaN,h:NaN};if((!Number.isFinite(i)||!Number.isFinite(c))&&(i=360,c=240),!Number.isFinite(s)||!Number.isFinite(a)){const u=this.opts.dock;s=u.includes("right")?o-i-24:24,a=u.includes("bottom")?r-c-24:24;}this.setSize(i,c),this.setPosition(s,a),(e?.collapsed??this.opts.collapsed)&&this.setCollapsed(true);}enableDragging(){const t=r=>{if(r.target?.closest(".cjai-panel__controls"))return;this.dragging=true;const s=this.root.getBoundingClientRect();this.dragOffset.x=r.clientX-s.left,this.dragOffset.y=r.clientY-s.top,this.root.style.transition="none",r.preventDefault();},e=r=>{if(!this.dragging)return;const s=window.innerWidth,a=window.innerHeight,i=this.root.getBoundingClientRect().width,c=this.root.getBoundingClientRect().height,d=I(r.clientX-this.dragOffset.x,0,s-i),u=I(r.clientY-this.dragOffset.y,0,a-c);this.root.style.left=`${d}px`,this.root.style.top=`${u}px`;},o=()=>{this.dragging&&(this.dragging=false,this.root.style.transition="",this.saveState());};this.header.addEventListener("mousedown",t),window.addEventListener("mousemove",e),window.addEventListener("mouseup",o),this.root.addEventListener("mousedown",r=>{this.isCollapsed()&&(r.target.closest(".cjai-panel__controls")||t(r));}),this.unsub.push(()=>{this.header.removeEventListener("mousedown",t),window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",o);});}enableResizing(){const t=this.resizeHandle,e=s=>{this.resizing=true;const a=this.root.getBoundingClientRect();this.resizeStart={w:a.width,h:a.height,x:s.clientX,y:s.clientY},this.root.style.transition="none",s.preventDefault();},o=s=>{if(!this.resizing)return;const a=s.clientX-this.resizeStart.x,i=s.clientY-this.resizeStart.y,c=I(this.resizeStart.w+a,240,Math.min(window.innerWidth-20,800)),d=I(this.resizeStart.h+i,120,Math.min(window.innerHeight-20,800));this.setSize(c,d);},r=()=>{this.resizing&&(this.resizing=false,this.root.style.transition="",this.saveState());};t.addEventListener("mousedown",e),window.addEventListener("mousemove",o),window.addEventListener("mouseup",r),this.unsub.push(()=>{t.removeEventListener("mousedown",e),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",r);});}isCollapsed(){return this.root.classList.contains("cjai-panel--collapsed")}setCollapsed(t){this.root.classList.toggle("cjai-panel--collapsed",t),this.saveState();}setTitle(t){this.titleEl.textContent=t;}setPosition(t,e){const o=window.innerWidth,r=window.innerHeight,s=this.root.getBoundingClientRect(),a=s.width||360,i=s.height||240;this.root.style.left=`${I(t,0,o-a)}px`,this.root.style.top=`${I(e,0,r-i)}px`,this.root.style.right="auto",this.root.style.bottom="auto";}setSize(t,e){this.root.style.width=`${Math.max(240,t)}px`,this.root.style.height=`${Math.max(100,e)}px`;}mount(t){const e=t||this.opts.mount||document.body;this.root.parentElement||e.appendChild(this.root);}destroy(){this.unsub.forEach(t=>{try{t();}catch{}}),this.unsub=[],this.root.remove();}clearActions(){this.actionsEl.innerHTML="";}addAction(t){const e=document.createElement("button");if(e.className="cjai-btn"+(t.kind==="primary"?" cjai-btn--primary":t.kind==="danger"?" cjai-btn--danger":""),e.textContent=t.label,t.tooltip&&(e.title=t.tooltip),t.hotkey){const r=document.createElement("span");r.className="cjai-chip",r.textContent=t.hotkey,e.appendChild(r);}e.disabled=!!t.disabled;const o=t.trigger==="dblclick"?"dblclick":"click";e.addEventListener(o,()=>t.onClick(this)),e.dataset.actionId=t.id,this.actionsEl.appendChild(e);}addTab({id:t,label:e,content:o,select:r=false}){if(this.panes.has(t))return this.panes.get(t);const s=document.createElement("button");s.className="cjai-tab",s.type="button",s.textContent=e,s.setAttribute("role","tab"),s.setAttribute("aria-controls",`pane-${t}`),s.setAttribute("aria-selected","false"),this.tabsBar.appendChild(s);const a=o??document.createElement("div");return o||(a.className="cjai-tabpane"),a.id=`pane-${t}`,a.dataset.active="false",this.contentWrap.appendChild(a),s.addEventListener("click",()=>this.selectTab(t)),this.panes.set(t,a),r&&this.selectTab(t),this.tabsBar.style.display=this.tabsBar.childElementCount>1?"flex":"none",a}selectTab(t){for(const e of Array.from(this.tabsBar.querySelectorAll(".cjai-tab"))){const o=e.getAttribute("aria-controls")===`pane-${t}`;e.setAttribute("aria-selected",String(o));}for(const[e,o]of this.panes.entries())o.dataset.active=String(e===t);}getTabPane(t){return this.panes.get(t)??null}updateAction(t,e){const o=this.actionsEl.querySelector(`button[data-action-id="${t}"]`);o&&(e.label!=null&&(o.firstChild?o.firstChild.textContent=e.label:o.textContent=e.label),e.tooltip!=null&&(o.title=e.tooltip||""),e.disabled!=null&&(o.disabled=!!e.disabled),e.kind&&(o.classList.remove("cjai-btn--primary","cjai-btn--danger"),e.kind==="primary"&&o.classList.add("cjai-btn--primary"),e.kind==="danger"&&o.classList.add("cjai-btn--danger")));}setDoc(t){if(this.contentEl.innerHTML="",typeof t=="string"){const e=document.createElement("div");e.className="cjai-doc",e.textContent=t,this.contentEl.appendChild(e);}else this.contentEl.appendChild(t);}setInfo(t){this.contentEl.innerHTML="";const e=Array.isArray(t)?t:Object.entries(t).map(([o,r])=>({key:o,label:o,value:r}));for(const o of e){const r=document.createElement("div");r.className="cjai-info-item";const s=document.createElement("div");s.className="cjai-info-key",s.textContent=o.label;const a=document.createElement("div");a.className="cjai-info-value",o.value instanceof HTMLElement?a.appendChild(o.value):a.textContent=String(o.value),o.tooltip&&(s.title=o.tooltip,a.title=o.tooltip),r.append(s,a),this.contentEl.appendChild(r);}}toast(t,e){const o=e?.type||"info",r=Math.max(1500,e?.duration??3500),s=document.createElement("div");s.className=`cjai-toast cjai-toast--${o}`,s.textContent=t,this.toastHost.appendChild(s),requestAnimationFrame(()=>{s.setAttribute("data-show","true");});const a=()=>{s.setAttribute("data-show","false"),setTimeout(()=>{s.remove();},220);},i=setTimeout(a,r);s.addEventListener("click",()=>{clearTimeout(i),a();});}}class ve{items=[];listeners=new Set;subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}emit(){for(const t of this.listeners)try{t();}catch{}}clear(){for(const t of this.items)t.url&&URL.revokeObjectURL(t.url);this.items=[],this.emit();}list(){return this.items.slice().sort((t,e)=>t.order-e.order)}get(t){return this.items.find(e=>e.order===t)}upsert(t){const e=this.items.findIndex(s=>s.order===t.order),o=e>=0?this.items[e]:{order:t.order,total:t.total??null,filename:t.filename||`question-${String(t.order).padStart(3,"0")}.png`,blob:null,url:null,status:t.status??"pending",createdAt:Date.now(),selected:true,error:void 0},r={...o,...t};r.blob&&r.blob!==o.blob&&(o.url&&URL.revokeObjectURL(o.url),r.url=URL.createObjectURL(r.blob)),e>=0?this.items[e]=r:this.items.push(r),this.emit();}setSelected(t,e){const o=this.get(t);o&&(o.selected=e,this.emit());}selectAll(t){for(const e of this.items)e.selected=t;this.emit();}toggle(t){const e=this.get(t);e&&(e.selected=!e.selected,this.emit());}selected(){return this.list().filter(t=>t.selected&&t.status==="ok"&&t.blob)}}class Se{map=new Map;listeners=new Set;subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}emit(){for(const t of this.listeners)try{t();}catch{}}clear(){this.map.clear(),this.emit();}setAll(t){this.map.clear();for(const e of t)this.map.set(e.order,e);this.emit();}upsert(t){this.map.set(t.order,t),this.emit();}get(t){return this.map.get(t)||null}list(){return Array.from(this.map.values()).sort((t,e)=>t.order-e.order)}toJSON(){return {version:"1.0",answers:this.list().map(t=>({order:t.order,type:t.type,choice:t.choices,answerText:t.text,explanation:t.explanation,confidence:t.confidence,source:t.source}))}}}function ke(n){if(!n)return "unknown";const t=String(n).toLowerCase();return /(single|单选)/.test(t)?"single":/(multiple|多选)/.test(t)?"multiple":/(true|false|判断)/.test(t)?"true_false":/(fill|填空)/.test(t)?"fill":/(short|简答|问答)/.test(t)?"short":"unknown"}function V(n){const e=(a=>typeof a=="string"?JSON.parse(a):a)(n),o=[],r=(a,i)=>{if(typeof a=="string"||Array.isArray(a)){const m=typeof i=="string"?parseInt(i,10):i,p=Array.isArray(a)?a.map(String):[String(a)];o.push({order:m,type:"unknown",choices:[],text:p});return}const c=Number(a.order??i),d=ke(a.type),u=Array.isArray(a.choice)?a.choice.map(String):[],l=a.answerText==null?[]:Array.isArray(a.answerText)?a.answerText.map(String):[String(a.answerText)];o.push({order:c,type:d,choices:u,text:l,explanation:a.explanation,confidence:a.confidence,source:a.source});},s=e.answers;if(Array.isArray(s))for(const a of s)r(a);else if(s&&typeof s=="object")for(const[a,i]of Object.entries(s))r(i,a);return o.filter(a=>Number.isFinite(a.order))}const Ee={version:"1.0",answers:[{order:1,type:"single",choice:["C"],explanation:"理由...",confidence:.93},{order:2,type:"multiple",choice:["A","D"],explanation:"理由...",confidence:.87},{order:3,type:"true_false",choice:["T"],explanation:"True 为正确，False 为错误"},{order:4,type:"fill",answerText:["第一空内容","第二空内容"]},{order:5,type:"short",answerText:["简答题作答要点 1","要点 2"]}],meta:{generator:"CJ-AI",ts:Date.now()}},mt="你是一个严谨的答题助手。根据我提供的“按顺序排列”的题目截图，输出 JSON 答案。",ht='\n要求：\n- 仅输出 JSON，请使用 ``` 包裹，不要解释或多余文本。\n- `order` 从 1 开始，按我提供的题目顺序递增。\n- 单选/多选：在 `choice` 字段中返回大写字母数组，例如 ["A"] 或 ["A","C"]。\n- 判断题：`choice` 使用 ["T"] 或 ["F"] 表示对/错。\n- 填空/简答：将文本答案拆分为数组，写入 `answerText`，每空或每行一个元素。\n- 如果无法确定题型，`type` 可为 "unknown"。\n- 可选：`explanation` 给出简要理由；`confidence` 给出 0~1 之间的置信度。\n',bt="You are a rigorous answering assistant. Given question screenshots in order, output answers as JSON.",yt='\nRules:\n- Output JSON only. No extra words.\n- `order` starts from 1 and follows the input order.\n- Single/Multiple choice: return uppercase letters in `choice`, e.g., ["A"] or ["A","C"].\n- True/False: use ["T"] or ["F"] in `choice`.\n- Fill-in/Short: split text into an array in `answerText`, one blank/line per item.\n- If unknown type, set `type` to "unknown".\n- Optional: `explanation` for brief rationale; `confidence` in [0,1].\n';function Ce(n){return n==="zh"?`${mt}

${ht}`.trim():n==="en"?`${bt}

${yt}`.trim():`${mt}

${ht}

${bt}

${yt}`.trim()}function F(n={}){const t=n.lang??"zh",e=n.version??"1.0",o=n.includeExample??true,r=n.customExample??Ee,s=(n.extraNotes??[]).map(l=>`- ${l}`).join(`
`),a=Ce(t),i=t==="en"?"JSON Schema/Shape":"JSON 形状与字段说明",c=t==="en"?"Example":"示例",d=t==="en"?"Return JSON only":"仅输出 JSON",u=JSON.stringify(r,null,2);return [a,s&&(t==="en"?`Notes:
`:`注意：
`)+s,`${i} (version: ${e}):
{
  "version": "${e}",
  "answers": [
    {
      "order": 1,
      "type": "single | multiple | true_false | fill | short | unknown",
      "choice": ["A"],
      "answerText": ["string"],
      "explanation": "string",
      "confidence": 0.9,
      "source": "optional"
    }
  ]
}`,o?`${c} (DO NOT COPY LITERALLY):
\`\`\`
${u}
\`\`\``:"",`${d}.`].filter(Boolean).join(`

`)}const Y="CJAI_BRIDGE_V1";function Jt(n){return !!n&&n.data&&n.data.channel===Y&&typeof n.data.type=="string"}function gt(n,t){const e=new Map,o=r=>{if(!Jt(r))return;const s=e.get(r.data.type);if(s)for(const a of Array.from(s))try{a(r.data);}catch{}};return window.addEventListener("message",o),{role:"client",target:n,origin:t,send:(r,s)=>{n.postMessage({channel:Y,type:r,payload:s,from:location.origin},t);},on:(r,s)=>{let a=e.get(r);return a||(a=new Set,e.set(r,a)),a.add(s),()=>{a.delete(s);}},destroy:()=>window.removeEventListener("message",o)}}function je(n){const t=new Map,e=o=>{if(!Jt(o)||!n.includes("*")&&!n.includes(o.origin))return;const r=t.get(o.data.type),s=(a,i)=>{o.source&&o.source.postMessage({channel:Y,type:a,payload:i,from:location.origin},o.origin);};if(r)for(const a of Array.from(r))try{a(o.data,s);}catch{}};return window.addEventListener("message",e),{role:"host",on:(o,r)=>{let s=t.get(o);return s||(s=new Set,t.set(o,s)),s.add(r),()=>{s.delete(r);}},destroy:()=>window.removeEventListener("message",e)}}function Ae(n,t="cjai-bridge",e="width=480,height=720"){try{return window.open(n,t,e)}catch{return null}}const K="https://www.doubao.com",U="https://www.doubao.com/";function Ne(){if(!location.origin.startsWith(K))return;const e=je(["https://changjiang.yuketang.cn","https://changjiang-exam.yuketang.cn"]);e.on("ping",(o,r)=>{console.log("[CJAI bridge@doubao] ping from",o.from,"payload:",o.payload),r("pong",{ok:true,at:Date.now()});}),e.on("db.compose",async(o,r)=>{try{const s=o.payload||{},a=s.text,i=!!s.send,c=s.fileName||s.name,d=s.dataUrl||s.imageDataUrl,u=s.blob,l=await $(6e3);if(!l){r("db.result",{ok:!1,reason:"composer-not-found"});return}if(a&&a.length&&!qe(l,a)){r("db.result",{ok:!1,reason:"set-text-failed"});return}let m=!1;if(u||d){const p=u||await Et(d),b=new File([p],c||`image-${Date.now()}.png`,{type:p.type||"image/png"});m=await kt(l,b)||!1;}if(i){if(m)try{await At(l,3e4);}catch{}const p=await St(l);r("db.result",{ok:p,attached:m});return}r("db.result",{ok:!0,attached:m});}catch(s){r("db.result",{ok:false,reason:String(s)});}}),e.on("db.attachImage",async(o,r)=>{try{const s=o.payload||{},a=s.fileName||s.name||`image-${Date.now()}.png`,i=s.dataUrl,c=s.blob,d=await $(6e3);if(!d){r("db.result",{ok:!1,reason:"composer-not-found"});return}const u=c||await Et(i),l=new File([u],a,{type:u.type||"image/png"}),m=await kt(d,l);r("db.result",{ok:m});}catch(s){r("db.result",{ok:false,reason:String(s)});}}),e.on("db.send",async(o,r)=>{try{const s=await $(6e3);if(!s){r("db.result",{ok:!1,reason:"composer-not-found"});return}const a=await St(s);r("db.result",{ok:a});}catch(s){r("db.result",{ok:false,reason:String(s)});}}),e.on("db.getLastJson",async(o,r)=>{try{const s=Fe();s?r("db.lastJson",{ok:!0,text:s}):r("db.lastJson",{ok:!1,reason:"json-not-found"});}catch(s){r("db.lastJson",{ok:false,reason:String(s)});}}),e.on("db.waitUploads",async(o,r)=>{const s=o.payload||{},a=Number(s.timeoutMs??25e3);try{const i=await $(6e3);if(!i){r("db.uploads",{ok:!1,reason:"composer-not-found"});return}const c=await At(i,a),d=zt(i);r("db.uploads",{ok:c,count:d});}catch(i){r("db.uploads",{ok:false,reason:String(i)});}}),C$1.info("Doubao host ready for CJ-AI bridge");}let y=null,w=null,_=null;function wt(){try{y&&!y.closed&&y.focus();}catch{}}function O(){if(y&&!y.closed){try{y.location&&y.location.href&&y.location.href.replace(/#.*$/,"")===U?y.location.reload():y.location.href=U;}catch{}if(!w)try{w=gt(y,K);}catch{}if(_){try{_();}catch{}_=null;}return w&&(_=w.on("pong",t=>{C$1.success("Doubao pong",t.payload);})),wt(),true}const n=Ae(U,"cjai-doubao","width=980,height=720");if(!n)return C$1.warn("Open Doubao popup failed"),false;if(y=n,w=gt(n,K),_){try{_();}catch{}_=null;}return _=w.on("pong",t=>{C$1.success("Doubao pong",t.payload);}),wt(),true}function Rt(){(!w||!y||y.closed)&&!O()||w.send("ping",{ts:Date.now()});}function P(n){if((!w||!y||y.closed)&&!O())return  false;try{return w.send("db.compose",n),!0}catch{return  false}}function Mt(n,t=`image-${Date.now()}.png`){if((!w||!y||y.closed)&&!O())return  false;try{return w.send("db.attachImage",{blob:n,fileName:t}),!0}catch{return  false}}function Te(){if((!w||!y||y.closed)&&!O())return  false;try{return w.send("db.send"),!0}catch{return  false}}function _e(n){const t=n.trim();if(!t||t[0]!=="{"&&t[0]!=="[")return  false;try{return JSON.parse(t),!0}catch{return  false}}function W(n,t,e="question.png"){return _e(n)?P({text:n,send:true}):P(t?{text:n,blob:t,fileName:e,send:true}:{text:n,send:true})}async function De(n=12e3,t=800){return (!w||!y||y.closed)&&!O()?false:new Promise(e=>{let o=false;const r=w.on("pong",()=>{o||(o=true,r(),clearTimeout(a),clearInterval(s),e(true));}),s=setInterval(()=>{try{w.send("ping",{ts:Date.now()});}catch{}},Math.max(300,t)),a=setTimeout(()=>{o||(o=true,r(),clearInterval(s),e(false));},Math.max(1e3,n));try{w.send("ping",{ts:Date.now()});}catch{}})}function G(n=8e3){return (!w||!y||y.closed)&&!O()?Promise.resolve({ok:false,reason:"no-bridge"}):new Promise(t=>{let e=false;const o=setTimeout(()=>{e||(r(),e=true,t({ok:false,reason:"timeout"}));},n),r=w.on("db.lastJson",s=>{if(e)return;e=true,r(),clearTimeout(o);const a=s.payload||{};t({ok:!!a.ok,text:a.text,reason:a.reason});});try{w.send("db.getLastJson");}catch{r(),clearTimeout(o),t({ok:false,reason:"send-failed"});}})}async function xt(n=25e3){return (!w||!y||y.closed)&&!O()?{ok:false,reason:"no-bridge"}:new Promise(t=>{let e=false;const o=setTimeout(()=>{e||(r(),e=true,t({ok:false,reason:"timeout"}));},n+1e3),r=w.on("db.uploads",s=>{if(e)return;e=true,r(),clearTimeout(o);const a=s.payload||{};t({ok:!!a.ok,count:a.count,reason:a.reason});});try{w.send("db.waitUploads",{timeoutMs:n});}catch{r(),clearTimeout(o),t({ok:false,reason:"send-failed"});}})}async function vt(n=6e4,t=2e3){const e=Date.now();for(;Date.now()-e<n;){const o=await G(Math.min(t+2e3,n));if(o.ok&&o.text)return o;await tt(t);}return {ok:false,reason:"timeout"}}function T(n){if(!n||!(n instanceof HTMLElement))return  false;const t=n.getBoundingClientRect(),e=getComputedStyle(n);return !(e.visibility==="hidden"||e.display==="none"||e.opacity==="0"||t.width<=0||t.height<=0)}function Oe(n){const t=[n.closest('div[class*="editor-container-"]'),n.closest('div[class*="input-content-container-"]'),n.closest('div[class*="container-QrxCka"]'),n.closest('div[class*="footer-"]')].filter(Boolean);return t.length?t[0]:Ie(n)}async function $(n=5e3){const t=Date.now();for(;Date.now()-t<n;){try{let s=Array.from(document.querySelectorAll("textarea")).filter(c=>T(c)&&!c.disabled).map(c=>({a:c,rect:c.getBoundingClientRect()})).sort((c,d)=>d.rect.top-c.rect.top)[0]?.a||null,a=null;s||(a=Array.from(document.querySelectorAll('[contenteditable="true"]')).filter(l=>T(l)).map(l=>({e:l,rect:l.getBoundingClientRect()})).sort((l,m)=>m.rect.top-l.rect.top)[0]?.e||null);const i=s||a;if(i&&T(i)){const c=Oe(i),d=Pe(c);return {textarea:s||null,editable:s?null:a,container:c,sendBtn:d}}}catch{}await new Promise(e=>setTimeout(e,200));}return null}function Ie(n){let t=n;for(let e=0;e<6&&t?.parentElement;e++)t=t.parentElement;return t||document.body}function Le(n){return (n.textContent||"").trim().replace(/\s+/g,"")}function Pe(n){const t=Array.from(n.querySelectorAll("button"));let e=null;for(const o of t){if(!T(o)||o.disabled)continue;const r=o.getBoundingClientRect(),s=r.top*.001+r.right*5e-4,a=Le(o)+" "+((o.getAttribute("aria-label")||"")+(o.getAttribute("title")||""));let i=0;/发送|Send/i.test(a)&&(i+=10),/发送/.test(a)&&(i+=5);const c=i+1/(1+s);(!e||c>e.score)&&(e={score:c,el:o});}return e?.el||null}function qe(n,t){try{if(n.textarea){const e=Object.getOwnPropertyDescriptor(HTMLTextAreaElement.prototype,"value")?.set;e?e.call(n.textarea,t):n.textarea.value=t,n.textarea.dispatchEvent(new Event("input",{bubbles:!0}));try{n.textarea.focus();}catch{}return !0}return n.editable?(n.editable.focus(),n.editable.textContent=t,n.editable.dispatchEvent(new Event("input",{bubbles:!0})),!0):!1}catch{return  false}}function Z(n){try{if(n.textarea)return (n.textarea.value||"").trim();if(n.editable)return (n.editable.textContent||"").trim()}catch{}return ""}async function St(n,t={}){const e=n.textarea||n.editable;if(!e)return  false;try{e.focus();}catch{}const o=Z(n);try{const c={key:"Enter",code:"Enter",keyCode:13,which:13,bubbles:!0,cancelable:!0};e.dispatchEvent(new KeyboardEvent("keydown",c)),e.dispatchEvent(new KeyboardEvent("keypress",c)),e.dispatchEvent(new KeyboardEvent("keyup",c));}catch{}const r=Math.max(300,t.timeoutMs??2e3),s=Math.max(50,t.pollMs??120),a=Date.now();for(;Date.now()-a<r;)if(await tt(s),Z(n).length===0)return  true;return Z(n).length===0&&o.length>0}async function kt(n,t){const e=n.container||n.textarea||n.editable||document.body;try{if(await Re(e,t))return !0}catch{}try{const o=Je(n.container);if(o&&await Me(o,t))return o.dispatchEvent(new Event("change",{bubbles:!0})),!0}catch{}return  false}function Je(n){const e=Array.from(n.querySelectorAll('input[type="file"]')).filter(r=>{const s=(r.accept||"").toLowerCase();return s.includes("image")||s.includes("png")||s.includes("jpg")||s.includes("jpeg")});return e.find(r=>T(r))||e[0]||null}async function Re(n,t){if(!("DataTransfer"in window))return  false;try{const e=new DataTransfer;e.items.add(t);const o={bubbles:!0,cancelable:!0,dataTransfer:e};return n.dispatchEvent(new DragEvent("dragenter",o)),n.dispatchEvent(new DragEvent("dragover",o)),n.dispatchEvent(new DragEvent("drop",o))}catch{return  false}}async function Me(n,t){try{const e=new DataTransfer;return e.items.add(t),n.files=e.files,!!n.files?.length}catch{return  false}}async function Et(n){const t=n.match(/^data:([^;]+);base64,(.*)$/);if(!t)return fetch(n).then(a=>a.blob());const e=t[2],o=atob(e),r=o.length,s=new Uint8Array(r);for(let a=0;a<r;a++)s[a]=o.charCodeAt(a);return new Blob([s],{type:t[1]||"application/octet-stream"})}function tt(n){return new Promise(t=>setTimeout(t,n))}function $e(){return Array.from(document.querySelectorAll('button[data-testid="message_action_copy"]')).filter(t=>T(t))}function ze(n){let t=n;for(let e=0;e<10&&t;e++){const o=t;if(o.querySelector("pre code, pre, code"))return o;t=o.parentElement;}t=n.parentElement;for(let e=0;e<4&&t?.parentElement;e++)t=t.parentElement;return t||null}function Ct(n){const t=n.trim();let e=t;const o=t.match(/```(?:json)?\s*([\s\S]*?)```/i);if(o&&(e=o[1]),!(e.startsWith("{")||e.startsWith("[")))return null;try{const r=JSON.parse(e);return r&&(Array.isArray(r.answers)||r.answers),r}catch{return null}}function Be(n){const t=[],e=Array.from(n.querySelectorAll("pre code"));for(const s of e)t.push(s.textContent||"");if(!t.length){const s=Array.from(n.querySelectorAll("pre"));for(const a of s)t.push(a.textContent||"");}if(!t.length){const s=Array.from(n.querySelectorAll("code"));for(const a of s)t.push(a.textContent||"");}for(const s of t){const a=Ct(s);if(a)return typeof a=="string"?a:JSON.stringify(a)}const o=n.textContent||"",r=Ct(o);return r?typeof r=="string"?r:JSON.stringify(r):null}function Fe(){const n=$e();if(!n.length)return null;for(let t=n.length-1;t>=0;t--){const e=n[t],o=ze(e);if(!o)continue;const r=Be(o);if(r)return r}return null}function $t(n){const t=[n],e=n.closest('div[class*="bottom-wrapper-"]')||n.closest('div[class*="right-area-"]')||n.closest('div[class*="editor-container-"]');e&&e!==n&&t.push(e);const o=new Set;for(const r of t){const s=Array.from(r.querySelectorAll('[data-testid="mdbox_image"], [data-testid="image"], .image-container-opAMeK, .image-wrapper-cymXaa'));for(const a of s)T(a)&&o.add(a);}if(o.size===0){const r=Array.from(document.querySelectorAll('[data-testid="mdbox_image"], [data-testid="image"], .image-container-opAMeK, .image-wrapper-cymXaa')),s=n.getBoundingClientRect();for(const a of r){const i=a.getBoundingClientRect();i.top>s.top-300&&i.top<s.bottom+1e3&&o.add(a);}}return Array.from(o.values())}function zt(n){return $t(n.container).length}function We(n){const e=n.closest('[class*="image-container-"], .image-container-opAMeK, .container-CVpVcp')||n,o=e.querySelector('[class*="loading-overlay"], .semi-progress-circle');if(o&&T(o))return  true;const r=o?.getAttribute("aria-valuenow");if(r&&Number(r)<100)return  true;const s=e.querySelector("img.image-Lgfrf0")||e.querySelector('[data-testid="mdbox_image"] img')||e.querySelector("img[imagex-type]")||e.querySelector("img");return s&&s.naturalWidth>0&&s.naturalHeight>0,false}function jt(n){const t=n.querySelector('[data-testid="chat_input_local_break_button"]')||document.querySelector('[data-testid="chat_input_local_break_button"]');return t?T(t):false}async function At(n,t=25e3){const e=Date.now();if(zt(n)===0&&!jt(n.container))return  true;for(;Date.now()-e<t;){const o=$t(n.container);if(C$1.info("Waiting uploads, found attachments:",o.length),!(jt(n.container)||o.some(s=>We(s))))return  true;await tt(300);}return  false}class He{constructor(t){this.store=t;const e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",e.style.height="100%",e.style.gap="8px";const o=document.createElement("div");o.style.display="flex",o.style.gap="8px",o.style.alignItems="center";const r=this.btn("Select All",()=>this.store.selectAll(true)),s=this.btn("Select None",()=>this.store.selectAll(false)),a=this.btn("Clear",()=>this.store.clear()),i=this.btn("Download Zip",()=>this.downloadZip()),c=this.btn("Save to Folder",()=>this.saveToDir()),d=this.btn("Download Files",()=>this.downloadSequential()),u=j("doubaoBridge")?this.btn("Send Selected → Doubao",()=>this.sendSelectedToDoubao()):null;o.append(r,s,i,c,d,...u?[u]:[],a);const l=document.createElement("div");l.style.display="grid",l.style.gridTemplateColumns="repeat(auto-fill, minmax(160px, 1fr))",l.style.gap="8px",l.style.overflow="auto",l.style.padding="2px",e.append(o,l),this.el=e,this.listEl=l,this.store.subscribe(()=>this.render()),this.render();}el;listEl;btn(t,e){const o=document.createElement("button");return o.textContent=t,o.className="cjai-btn",o.onclick=e,o}card(t){const e=document.createElement("div");e.style.border="1px solid var(--cjai-border)",e.style.borderRadius="8px",e.style.overflow="hidden",e.style.background="var(--cjai-bg)",e.style.display="flex",e.style.flexDirection="column",e.style.gap="6px",e.style.padding="6px";const o=document.createElement("div");o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="space-between",o.style.gap="6px";const r=document.createElement("div");r.style.display="flex",r.style.gap="6px",r.style.alignItems="center";const s=document.createElement("input");s.type="checkbox",s.checked=t.selected,s.onchange=()=>this.store.setSelected(t.order,s.checked);const a=document.createElement("div");a.textContent=`#${t.order}`,r.append(s,a);const i=document.createElement("div");i.style.display="flex",i.style.gap="6px";const c=this.btn("Retry",()=>this.retry(t.order)),d=this.btn("Open",()=>{t.url&&window.open(t.url,"_blank");}),u=j("doubaoBridge")?this.btn("Send",()=>this.sendOneToDoubao(t)):null;i.append(c,d,...u?[u]:[]),o.append(r,i);const l=document.createElement("div");if(l.style.aspectRatio="4/3",l.style.overflow="hidden",l.style.background="rgba(0,0,0,0.03)",l.style.border="1px solid var(--cjai-border)",l.style.borderRadius="6px",t.url){const p=document.createElement("img");p.src=t.url,p.style.width="100%",p.style.height="100%",p.style.objectFit="contain",l.appendChild(p);}else l.textContent=t.status==="pending"?"Pending…":"No image",l.style.display="grid",l.style.placeItems="center";const m=document.createElement("div");return m.style.fontSize="12px",m.style.color="var(--cjai-ink-muted)",m.textContent=t.filename,e.append(o,l,m),e}buildImagePrompt(t){const e=[];return t!=null?e.push(`仅针对当前图片作答；请只返回一个 answers 项，并将 order 固定为 ${t}。`):e.push("仅针对当前图片作答；请只返回一个 answers 项。"),F({lang:"zh",includeExample:true,extraNotes:e})}async sendOneToDoubao(t){try{if(!t.blob){C$1.warn("No image to send");return}const e=this.buildImagePrompt(t.order);W(e,t.blob,t.filename||`question-${t.order}.png`)||C$1.warn("Send to Doubao failed to dispatch");}catch(e){C$1.error("Send one to Doubao failed",e);}}async sendSelectedToDoubao(){const t=this.store.selected();if(!t.length){C$1.warn("No selected captures");return}C$1.banner("Doubao",`Sending ${t.length} selected captures`);for(const e of t)await this.sendOneToDoubao(e),await v$1(1600);C$1.success("Queued sending to Doubao");}async retry(t){C$1.info("Retry capture",t);const e=new CustomEvent("cjai:retry",{detail:{order:t}});window.dispatchEvent(e);}selectedFiles(){return this.store.selected().map(t=>({name:t.filename,blob:t.blob}))}async downloadZip(){const t=this.selectedFiles();if(!t.length)return;await me(t,"captures.zip")||C$1.warn("Zip not available, try other download method");}async saveToDir(){const t=this.selectedFiles();if(!t.length)return;await be(t)||C$1.warn("Cannot save to directory (unsupported or denied)");}async downloadSequential(){const t=this.selectedFiles();t.length&&await he(t);}render(){this.listEl.innerHTML="";for(const t of this.store.list())this.listEl.appendChild(this.card(t));}}function A(n){return (n?.textContent||"").replace(/\u00A0/g," ").replace(/\s+/g," ").trim()}function Ue(){return document.querySelector(".container-problem .el-scrollbar__view")||document.querySelector(".container-problem")||document}function Bt(){const n=Ue(),t=Array.from(n.querySelectorAll(".subject-item"));t.length===0&&C$1.warn("No .subject-item found when extracting JSON");const e=[],o=new Set;for(let r=0;r<t.length;r++){const s=t[r],a=s.querySelector(".item-type"),i=A(a),c=/(\d+)\.(\S+)\s*\((\d+(?:\.\d+)?)分\)/.exec(i)||/(\d+)\s*[\.、]\s*(\S+).*?(\d+(?:\.\d+)?)\s*分/.exec(i),d=c?parseInt(c[1],10):r+1,u=c?c[2]:"",l=c?Math.round(parseFloat(c[3])*100)/100:0,p=s.querySelector(".status")?"已提交":"未提交",b=/填空/.test(i)||/填空/.test(u);let h="",S=0,k=[];if(b){const g=Ze(s);h=g.question,S=g.blanks,k=g.answers;}else {const g=s.querySelector(".item-body h4");if(g){const E=g.querySelector(".custom_ueditor_cn_body");if(E){const C=E.querySelector("p");h=A(C||E);}else {const C=g.querySelector("p");h=A(C||g);}}else {const E=s.querySelector(".item-body .custom_ueditor_cn_body")||s.querySelector(".item-body");h=A(E);}}const x=[];s.querySelectorAll(".list-unstyled-radio li").forEach(g=>{const E=g.querySelector(".radioInput");let C=g.querySelector(".radioText .custom_ueditor_cn_body");if(C||(C=g.querySelector(".radioText")),!E||!C)return;const H=C.querySelector("p"),M=A(H||C),at=A(E);at&&x.push({key:at,value:M});}),s.querySelectorAll(".list-unstyled-checkbox li").forEach(g=>{const E=g.querySelector(".checkboxInput");let C=g.querySelector(".checkboxText .custom_ueditor_cn_body");if(C||(C=g.querySelector(".checkboxText")),!E||!C)return;const H=A(C),M=A(E);M&&x.push({key:M,value:H});}),s.querySelectorAll(".list-inline.list-unstyled-radio li").length===2&&x.length===0&&(x.push({key:"✓",value:"正确"}),x.push({key:"✗",value:"错误"}));let q=null;const et=s.querySelector(".el-radio.is-checked");if(et){const g=et.querySelector(".radioInput");g&&(q=A(g));}const nt=Array.from(s.querySelectorAll(".el-checkbox.is-checked"));if(nt.length>0){q=[];for(const g of nt){const E=g.querySelector(".checkboxInput"),C=A(E);C&&q.push(C);}}if(b){const g=k.map(E=>E.trim()).filter(E=>E.length>0);g.length>0&&(q=g);}const ot=h.trim()!==""&&u!==""&&l>0,rt=o.has(d);if(!ot||rt){C$1.debug("Skip item",{id:d,valid:ot,dup:rt,typeText:i});continue}o.add(d);const st={id:d,type:u,score:l,status:p,question:h,options:x,selected:q,rawTypeText:i};b&&(st.blanks=S),e.push(st);}return C$1.success("Extracted questions",e.length),e}function Ze(n){const t=n.querySelector(".item-body")||n,e=Array.from(t.querySelectorAll('input.blank-item-dynamic, input[type="text"].blank-item-dynamic, input.blank-item, input[type="text"]')),o=e.map(u=>(u.value||"").trim()),r=t.querySelector(".exam-font")||t.querySelector(".custom_ueditor_cn_body")||t;let s=0;const a=[],i=u=>{if(u.nodeType===Node.TEXT_NODE){const p=(u.textContent||"").replace(/\u00A0/g," ");a.push(p);return}if(!(u instanceof Element))return;const l=u;if(l.tagName.toLowerCase()==="input"&&l.type==="text"){s+=1,a.push(`【空${s}】`);return}const m=Array.from(l.childNodes);if(m.length!==0)for(const p of m)i(p);};i(r);let c=a.join("");c=c.replace(/\s+/g," ").replace(/\s([，。！？；,.!?])/g,"$1").trim();const d=Math.max(e.length,s);return {question:c,blanks:d,answers:o}}function Ve(n){try{return JSON.parse(n)}catch{return null}}function Nt(n,t){try{return JSON.stringify(n,null,t?void 0:2)}catch{return String(n??"")}}function X(n,t={}){const e=t.lang??"zh",o=F({lang:e,includeExample:t.includeExample!==false,extraNotes:t.extraNotes}),r=typeof n=="string"?Ve(n)??n:n,s=typeof r=="string"?r:Nt(r,t.minifyJson!==false),a=e==="en"?"Questions JSON (in order):":"按顺序排列的题目 JSON：",i=`${o}

${a}

\`\`\`json
${s}
\`\`\``;if(!t.maxChars||i.length<=t.maxChars)return i;const c=(()=>{if(typeof r=="string")return i;const u=Nt(r,true);return `${o}

${a}

\`\`\`json
${u}
\`\`\``})();if(c.length<=(t.maxChars||0))return c;const d=s.slice(0,Math.max(0,(t.maxChars||0)-o.length-a.length-32))+`
/* clipped */`;return `${o}

${a}

\`\`\`json
${d}
\`\`\``}class Ke{el;textarea;btnScan;btnCopy;btnDownload;btnCopyPrompt;btnSendDoubao;langSelect;includeExample;minifyJson;status;constructor(){const t=document.createElement("div");t.style.display="flex",t.style.flexDirection="column",t.style.height="100%",t.style.gap="8px";const e=document.createElement("div");e.style.display="flex",e.style.gap="8px",e.style.alignItems="center",e.style.border="1px solid var(--cjai-border)",e.style.borderRadius="8px",e.style.padding="6px";const o=document.createElement("button");o.className="cjai-btn cjai-btn--primary",o.textContent="Scan Page";const r=document.createElement("button");r.className="cjai-btn",r.textContent="Copy JSON";const s=document.createElement("button");s.className="cjai-btn",s.textContent="Download";const a=document.createElement("button");a.className="cjai-btn",a.textContent="Copy Prompt";const i=document.createElement("button");i.className="cjai-btn",i.textContent="Send to Doubao";const c=document.createElement("select");c.className="cjai-btn";const d=document.createElement("option");d.value="zh",d.textContent="中文";const u=document.createElement("option");u.value="en",u.textContent="English";const l=document.createElement("option");l.value="zh-en",l.textContent="中英",c.append(d,u,l),c.value="zh";const m=document.createElement("label");m.style.display="inline-flex",m.style.alignItems="center",m.style.gap="4px";const p=document.createElement("input");p.type="checkbox",p.checked=true;const b=document.createElement("span");b.textContent="Example",m.append(p,b);const h=document.createElement("label");h.style.display="inline-flex",h.style.alignItems="center",h.style.gap="4px";const S=document.createElement("input");S.type="checkbox",S.checked=true;const k=document.createElement("span");k.textContent="Minify",h.append(S,k);const x=document.createElement("div");x.style.marginLeft="auto",x.style.fontSize="12px",x.style.color="var(--cjai-ink-muted)",e.append(o,r,s,a,i,c,m,h,x);const N=document.createElement("textarea");N.style.flex="1",N.style.width="100%",N.style.resize="none",N.style.border="1px solid var(--cjai-border)",N.style.borderRadius="8px",N.style.padding="8px",t.append(e,N),this.el=t,this.textarea=N,this.btnScan=o,this.btnCopy=r,this.btnDownload=s,this.btnCopyPrompt=a,this.btnSendDoubao=i,this.langSelect=c,this.includeExample=p,this.minifyJson=S,this.status=x,this.btnScan.onclick=()=>this.scan(),this.btnCopy.onclick=()=>this.copy(),this.btnDownload.onclick=()=>this.download(),this.btnCopyPrompt.onclick=()=>this.copyPrompt(),this.btnSendDoubao.onclick=()=>this.sendToDoubao();}setStatus(t,e=true){this.status.textContent=t,this.status.style.color=e?"var(--cjai-ink-muted)":"#e11d48";}update(t){this.textarea.value=t;}scan(){try{const t=Bt();if(!t.length){this.setStatus("No questions found",!1);return}const e=JSON.stringify(t,null,2);this.update(e),this.setStatus(`Extracted ${t.length} questions`);}catch(t){C$1.error("Scan failed",t),this.setStatus("Scan failed",false);}}async copy(){try{await navigator.clipboard.writeText(this.textarea.value),this.setStatus("Copied");}catch{this.setStatus("Copy failed",false);}}download(){try{const t=new Blob([this.textarea.value||"[]"],{type:"application/json"}),e=URL.createObjectURL(t),o=document.createElement("a");o.href=e,o.download="questions.json",document.body.appendChild(o),o.click(),o.remove(),setTimeout(()=>URL.revokeObjectURL(e),8e3),this.setStatus("Downloaded");}catch{this.setStatus("Download failed",false);}}async copyPrompt(){const t=this.textarea.value.trim();if(!t){this.setStatus("No JSON",false);return}try{const e=X(t,{lang:this.langSelect.value,includeExample:this.includeExample.checked,minifyJson:this.minifyJson.checked,extraNotes:["请严格依题目顺序（order 从 1 开始）。","如题目为填空题，按空序填写 answerText 数组。"]});await navigator.clipboard.writeText(e),this.setStatus("Prompt copied");}catch(e){C$1.error("Copy prompt failed",e),this.setStatus("Copy prompt failed",false);}}async sendToDoubao(){const t=this.textarea.value.trim();if(!t){this.setStatus("No JSON",false);return}try{const e=X(t,{lang:this.langSelect.value,includeExample:this.includeExample.checked,minifyJson:this.minifyJson.checked,extraNotes:["请严格依题目顺序（order 从 1 开始）。","如题目为填空题，按空序填写 answerText 数组。"]});if(!W(e)){this.setStatus("Bridge not ready",!1);return}this.setStatus("Sent to Doubao"),setTimeout(async()=>{try{const r=await G(2e4);if(!r.ok||!r.text){this.setStatus("No AI JSON yet");return}const s=window.CJAI?.importAnswers?.(r.text)??0;this.setStatus(`Imported ${s} answers`);}catch(r){C$1.error("Auto import from Doubao failed",r),this.setStatus("Auto import failed",!1);}},5e3);}catch(e){C$1.error("Send to Doubao failed",e),this.setStatus("Send failed",false);}}}class Xe{constructor(t){this.store=t;const e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",e.style.height="100%",e.style.gap="8px";const o=document.createElement("div");o.style.display="flex",o.style.gap="8px",o.style.alignItems="center",o.style.border="1px solid var(--cjai-border)",o.style.borderRadius="8px",o.style.padding="6px";const r=document.createElement("button");r.className="cjai-btn cjai-btn--primary",r.textContent="Copy Prompt";const s=document.createElement("button");s.className="cjai-btn",s.textContent="Parse JSON";const a=document.createElement("button");a.className="cjai-btn",a.textContent="Pull Doubao";const i=document.createElement("select");i.className="cjai-btn";const c=document.createElement("option");c.value="zh",c.textContent="中文";const d=document.createElement("option");d.value="en",d.textContent="English";const u=document.createElement("option");u.value="zh-en",u.textContent="中英",i.append(c,d,u),i.value="zh";const l=document.createElement("label");l.style.display="inline-flex",l.style.alignItems="center",l.style.gap="4px";const m=document.createElement("input");m.type="checkbox",m.checked=true;const p=document.createElement("span");p.textContent="Example",l.append(m,p);const b=document.createElement("div");b.style.marginLeft="auto",b.style.fontSize="12px",b.style.color="var(--cjai-ink-muted)";const h=document.createElement("button");h.className="cjai-btn",h.textContent="Hide Input",o.append(r,i,l,s,a,h,b);const S=document.createElement("div");S.style.display="block";const k=document.createElement("textarea");k.placeholder="粘贴答题器输出的 JSON（见示例格式）",k.style.width="100%",k.style.height="120px",k.style.border="1px solid var(--cjai-border)",k.style.borderRadius="8px",k.style.padding="8px",k.spellcheck=false,S.appendChild(k);const x=document.createElement("div");x.style.flex="1",x.style.overflow="auto",x.style.border="1px solid var(--cjai-border)",x.style.borderRadius="8px",x.style.padding="8px",e.append(o,S,x),this.el=e,this.input=k,this.btnParse=s,this.btnPrompt=r,this.langSelect=i,this.includeExample=m,this.list=x,this.status=b,this.btnToggleInput=h,this.inputWrap=S,this.btnPullDoubao=a,this.btnParse.onclick=()=>this.parse(),this.btnPrompt.onclick=()=>this.copyPrompt(),this.btnPullDoubao.onclick=()=>this.pullDoubao(),this.btnToggleInput.onclick=()=>this.setInputCollapsed(!this.collapsed),this.store.subscribe(()=>this.render()),this.render();}el;input;btnParse;btnPrompt;langSelect;includeExample;list;status;btnToggleInput;inputWrap;collapsed=false;highlightedOrder=null;btnPullDoubao;setStatus(t,e=true){this.status.textContent=t,this.status.style.color=e?"var(--cjai-ink-muted)":"#e11d48";}setInputText(t){this.input.value=t;}async copy(t){try{await navigator.clipboard.writeText(t),this.setStatus("Copied");}catch{this.setStatus("Copy failed",false);}}async copyPrompt(){const t={lang:this.langSelect.value??"zh",includeExample:this.includeExample.checked},e=F(t);await this.copy(e);}async pullDoubao(){try{this.setStatus("Pulling from Doubao…");const t=await G(12e3);if(!t.ok||!t.text){this.setStatus(t.reason||"No JSON found",!1);return}this.setInputText(t.text);try{const e=V(t.text);for(const o of e)this.store.upsert(o);this.afterParseSuccess(e.length),this.setStatus("Imported from Doubao");}catch(e){C$1.error("Normalize answers failed",e),this.setStatus("JSON parse error",!1);}}catch(t){C$1.error("Pull Doubao failed",t),this.setStatus("Pull failed",false);}}setInputCollapsed(t){this.collapsed=t,this.inputWrap.style.display=t?"none":"block",this.btnToggleInput.textContent=t?"Show Input":"Hide Input";}setCurrentOrder(t){this.highlightedOrder=t??null;for(const e of Array.from(this.list.querySelectorAll("[data-order]"))){const o=Number(e.dataset.order);e.style.background=this.highlightedOrder===o?"rgba(17, 17, 17, 0.06)":"transparent",e.style.borderRadius="6px";}t!=null&&this.scrollToOrder(t);}scrollToOrder(t){const e=this.list.querySelector(`[data-order="${t}"]`);if(!e)return;const r=this.list.getBoundingClientRect(),s=e.getBoundingClientRect();(s.top<r.top||s.bottom>r.bottom)&&e.scrollIntoView({block:"center"});}badge(t){const e=document.createElement("span");return e.textContent=t,e.style.fontSize="11px",e.style.border="1px solid var(--cjai-border)",e.style.padding="2px 6px",e.style.borderRadius="999px",e.style.marginLeft="6px",e.style.color="var(--cjai-ink-muted)",e}render(){this.list.innerHTML="";const t=this.store.list();if(!t.length){const e=document.createElement("div");e.textContent="暂无答案，请粘贴 JSON 并解析",this.list.appendChild(e);return}for(const e of t){const o=document.createElement("div");o.style.display="flex",o.style.flexDirection="column",o.style.gap="4px",o.style.padding="8px 6px",o.style.borderBottom="1px dashed var(--cjai-border)",o.dataset.order=String(e.order);const r=document.createElement("div");r.style.display="flex",r.style.alignItems="center",r.style.gap="6px";const s=document.createElement("div");s.textContent=`#${e.order}`,s.style.fontWeight="600";const a=this.badge(e.type);e.confidence!=null?r.append(s,a,this.badge(`${Math.round(e.confidence*100)}%`)):r.append(s,a);const i=document.createElement("div");i.style.fontFamily="ui-monospace, SFMono-Regular, Menlo, Consolas, monospace",e.choices.length?i.textContent=`Choice: ${e.choices.join(", ")}`:e.text.length?i.textContent=`Text: ${e.text.join(" | ")}`:i.textContent="(empty)";const c=document.createElement("div");c.style.whiteSpace="pre-wrap",c.style.color="var(--cjai-ink-muted)",c.textContent=e.explanation||"",o.append(r,i,c),this.list.appendChild(o);}this.highlightedOrder!=null&&this.setCurrentOrder(this.highlightedOrder);}afterParseSuccess(t){this.setStatus(`Parsed ${t} answers`),this.setInputCollapsed(true);}parse(){const t=this.input.value.trim();if(!t){this.setStatus("No input");return}try{const e=V(t);this.store.setAll(e),this.afterParseSuccess(e.length);}catch(e){C$1.error("Parse notepad JSON failed",e),this.setStatus("JSON parse error",false);}}}function Tt(n,t){return (n.textContent||"").replace(/\s+/g," ").trim().includes(t)}function Qe(){const t=R().selectors?.submitButton,e=t?document.querySelector(t):null;if(e)return e;const o=document.querySelector(".container-problem .problem-fixedbar")||document.querySelector(".problem-fixedbar");if(o){const s=Array.from(o.querySelectorAll("button")),a=s.find(c=>Tt(c,"提交"));if(a)return a;const i=s.find(c=>c.className.includes("el-button--primary"));if(i)return i}const r=Array.from(document.querySelectorAll("button")).find(s=>Tt(s,"提交"));return r||null}function Ye(){const n=Qe();if(!n)return C$1.warn("Submit button not found"),false;try{return n.focus(),n.click(),C$1.success("Triggered submit"),!0}catch(t){return C$1.error("Submit click failed",t),false}}const _t="CJ_AI_FLAGS_";function Ge(n){const t=document.createElement("label");t.className="cjai-switch";const e=document.createElement("input");e.type="checkbox",e.checked=n;const o=document.createElement("span");return o.className="cjai-switch__slider",t.append(e,o),{el:t,input:e}}class tn{el;toggles=new Map;base=It();eff=R();status;constructor(){const t=document.createElement("div");t.className="cjai-section";const e=document.createElement("div");e.className="cjai-section__title",e.textContent="Feature Flags | 特性开关";const o=document.createElement("div");o.className="cjai-section__description",o.textContent="启用或禁用实验性功能，一般情况下并不需要修改此设置，功能会随着作用域自动更新。";const r=document.createElement("div");r.style.fontSize="12px",r.style.color="var(--cjai-ink-muted)",r.textContent=`Domain: ${this.base.domain}  •  Host: ${location.hostname}`;const s=document.createElement("div");s.className="cjai-rows";for(const[l,m]of Object.entries(this.eff.flags)){const p=document.createElement("div");p.className="cjai-row";const b=document.createElement("div");b.className="cjai-row__label",b.textContent=l;const h=Ge(!!m);p.append(b,h.el),s.appendChild(p),this.toggles.set(l,h.input);}const a=document.createElement("div");a.style.display="flex",a.style.gap="8px",a.style.marginTop="8px";const i=document.createElement("button");i.className="cjai-btn cjai-btn--primary",i.textContent="Apply";const c=document.createElement("button");c.className="cjai-btn",c.textContent="Reset";const d=document.createElement("button");d.className="cjai-btn",d.textContent="Reload";const u=document.createElement("div");u.style.marginLeft="auto",u.style.fontSize="12px",u.style.color="var(--cjai-ink-muted)",a.append(i,c,d,u),t.append(e,o,r,s,a),this.el=t,this.status=u,i.onclick=()=>this.apply(),c.onclick=()=>this.reset(),d.onclick=()=>location.reload();}setStatus(t,e=true){this.status.textContent=t,this.status.style.color=e?"var(--cjai-ink-muted)":"#e11d48";}apply(){try{const t=this.base.flags,e={};let o=!1;for(const[s,a]of this.toggles.entries()){const i=!!a.checked;e[s]=i,t[s]!==i&&(o=!0);}const r=`${_t}${this.base.domain}`;o?(localStorage.setItem(r,JSON.stringify({flags:e})),this.setStatus("Overrides saved. Reload to take effect.")):(localStorage.removeItem(r),this.setStatus("No changes (overrides cleared)"));}catch(t){C$1.error("Apply flags failed",t),this.setStatus("Apply failed",false);}}reset(){try{const t=`${_t}${this.base.domain}`;localStorage.removeItem(t);for(const[e,o]of this.toggles.entries())o.checked=!!this.base.flags[e];this.setStatus("Overrides cleared");}catch(t){C$1.error("Reset flags failed",t),this.setStatus("Reset failed",false);}}}const en=R(),B=new ve,Q=new Se,L=new ye({delayAfterNavigateMs:200,screenshot:{scale:Math.max(2,window.devicePixelRatio||1),backgroundColor:"#fff"},onCapture:n=>B.upsert(n)}),J={nav:v,waitForQuestionElement:Lt,runner:L,start:()=>L.captureAllFromCurrent(),stop:()=>L.stop(),one:n=>L.captureOne(n),store:B,answers:Q,importAnswers:n=>{const t=V(n);return Q.setAll(t),t.length},features:en,doubao:{ping:()=>Rt(),compose:n=>P(n),attach:(n,t)=>Mt(n,t),send:()=>Te(),sendPrompt:(n,t)=>W(n,t)}};window.CJAI=J;C$1.banner("Injected","CJ-AI ready");C$1.info("Use in console:","CJAI.start()","CJAI.stop()","CJAI.one(n)");Ne();if(j("actionPanel")){const n=new xe({id:"cjai-panel",title:"CJ N-IN-1 ToolBox",dock:"bottom-right"});j$1((o,r)=>n.toast(o,r)),T$1(["error","warn","success","info"]);{const o=document.createElement("div"),r=document.createElement("div");r.className="cjai-section";const s=document.createElement("div");s.className="cjai-section__title",s.textContent="About";const a=document.createElement("div");a.className="cjai-doc",a.textContent=`• Tabs 说明：
  - Preview（截图预览，测试页面专属）：点击 Start 从“当前题”至“最后一题”依次截图；可在列表中勾选后 Download Zip / Save to Folder / Download Files；Retry 可重拍某题。
  - Extract（题目提取，考试页面专属）：Scan Page 获取题目 JSON；Copy Prompt 生成给 AI 的提示词（内含题目 JSON）；Download 保存 JSON 文件。
  - Notepad（答案簿）：将返回的 AnswerDoc JSON 粘贴→Parse JSON；列表按题号展示，跟随左侧导航自动滚动；输入区可 Hide/Show；Copy Prompt 可复制标准提示词模板。
• 快捷键：Cmd/Ctrl + E 触发页面提交按钮。
• Feature Flags：Info 面板下方可切换功能开关；Apply 后 Reload 生效。一般来说，并不需要修改这些设置，功能会随着作用域自动更新。

## Brand New Features
• Doubao Bridge: 在 doubao.com 页面可使用 CJAI.doubao 相关方法与豆包 AI 桥接，发送提示词并接收 AI 解题。
• Auto Watch: 在“课程播放”页面自动播放未完成的视频课节，支持倍速播放和自动跳过已完成课节。

`,r.append(s,a);const i=new tn;o.append(r,i.el),n.setDoc(o);}if(n.clearActions(),j("capture")&&(n.addAction({id:"start",label:"Start",kind:"primary",tooltip:"Capture all from current",hotkey:"S",onClick:()=>J.start()}),n.addAction({id:"stop",label:"Stop",kind:"danger",tooltip:"Stop capture",hotkey:"X",onClick:()=>J.stop()})),j("orderNav")&&(n.addAction({id:"prev",label:"Prev",tooltip:"Go to previous",hotkey:"A",onClick:()=>{v.prev();}}),n.addAction({id:"next",label:"Next",tooltip:"Go to next",hotkey:"D",onClick:()=>{v.next();}})),j("doubaoBridge")&&(n.addAction({id:"db-connect",label:"Doubao: Ping",tooltip:"Open Doubao (reuse) and send ping",onClick:()=>{C$1.toast("Ping sent to Doubao.",{type:"success"}),Rt();}}),n.addAction({id:"db-send-test",label:"Doubao: Send Test",tooltip:"Compose test text and send",onClick:()=>{P({text:"Hello from CJ-AI bridge at "+new Date().toLocaleTimeString(),send:true});}}),n.addAction({id:"db-oneclick",label:"One-Click Solve",kind:"primary",tooltip:"Run · Capture/Scan → Doubao → Import JSON → Notepad",onClick:async()=>{C$1.toast("Starting One-Click Solve flow...",{type:"info"});try{if(C$1.toast("Ensuring Doubao is ready..."),!await De(15e3,800)){C$1.warn("Doubao not ready (no pong). Abort.");return}if(j("questionExport")){C$1.banner("One-Click","Scan questions JSON");const r=Bt();if(!r.length){C$1.warn("No questions found");return}const s=X(r,{lang:"zh",includeExample:!0,minifyJson:!0,extraNotes:["请严格依题目顺序（order 从 1 开始）。"]});if(!W(s)){C$1.warn("Failed to send to Doubao");return}C$1.toast("已发送到豆包。如果没有自动发送，请切到豆包窗口按 Enter。",{type:"info",duration:6e3}),C$1.info("Waiting for AI JSON...");const i=await vt(9e4,3e3);if(!i.ok||!i.text){C$1.warn("No AI JSON");return}const c=J.importAnswers(i.text);C$1.success("Imported answers",c),n.selectTab("notepad");return}if(j("capture")){C$1.banner("One-Click","Capture all questions"),await L.captureAllFromCurrent();const r=B.selected();if(!r.length){C$1.warn("No captures to send");return}C$1.info("Attaching images to Doubao",r.length);for(const u of r)u.blob&&Mt(u.blob,u.filename),await new Promise(l=>setTimeout(l,200));let s=await xt(6e4);if(s.ok||(C$1.warn("Uploads still in progress, extend wait",s.reason||""),s=await xt(3e4)),!s.ok){C$1.warn("Uploads not ready, abort send");return}const a=F({lang:"zh",includeExample:!0,extraNotes:["请按截图顺序作答，输出 AnswerDoc JSON，order 从 1 开始。"]});if(!P({text:a,send:!0})){C$1.warn("Failed to send");return}C$1.toast("已发送到豆包。如果没有自动发送，请切到豆包窗口按 Enter。",{type:"info",duration:6e3}),C$1.info("Waiting for AI JSON...");const c=await vt(12e4,4e3);if(!c.ok||!c.text){C$1.warn("No AI JSON");return}const d=J.importAnswers(c.text);C$1.success("Imported answers",d),n.selectTab("notepad");return}C$1.warn("No supported mode (capture or questionExport)");}catch(o){C$1.toast("One-Click flow failed. See console.",{type:"error",duration:8e3}),C$1.error("One-Click flow failed",o);}}})),j("capture")){const o=n.addTab({id:"preview",label:"Preview"}),r=new He(B);o.appendChild(r.el);}const t=n.addTab({id:"notepad",label:"Notepad"}),e=new Xe(Q);if(t.appendChild(e.el),j("questionExport")){const o=n.addTab({id:"extract",label:"Extract"}),r=new Ke;o.appendChild(r.el);}if(j("autoWatch")){const o=n.addTab({id:"watch",label:"Watch"}),r=(await Kt(async()=>{const{default:a}=await module.import('./auto-watch-Ble6cda--DHOKQlKi.js');return {default:a}},void 0)).default,s=new r;o.appendChild(s.el);}if(j("orderNav")){let o=null;setInterval(()=>{try{const r=v.current();r&&r!==o&&(o=r,e.setCurrentOrder(r));}catch{}},600);}}j("capture")&&window.addEventListener("cjai:retry",n=>{const t=Number(n?.detail?.order);t&&L.captureOne(t);});j("submitHotkey")&&window.addEventListener("keydown",n=>{const t=n.metaKey,e=n.ctrlKey;(t||e)&&!n.shiftKey&&!n.altKey&&n.key?.toLowerCase()==="e"&&(n.preventDefault(),Ye());});

    })
  };
}));

System.register("./auto-watch-Ble6cda--DHOKQlKi.js", ['./wait-CYghtssh-DEyvWMVm.js'], (function (exports, module) {
	'use strict';
	var C$1, v;
	return {
		setters: [module => {
			C$1 = module.C;
			v = module.v;
		}],
		execute: (function () {

			class E{running=false;observer=null;rate=2;onStatus;log;constructor(t={}){this.rate=t.rate??2,this.onStatus=t.onStatus,this.log=t.log||C$1.withScope("ykt");}setRate(t){this.rate=t;}status(t){try{this.onStatus?.(t);}catch{}}stop(){this.running=false;try{this.observer?.disconnect();}catch{}this.observer=null,this.status("Stopped"),this.log.warn("Stopped"),this.log.toast("Auto Watch: Stopped",{type:"warn"});}async start(t){if(!t?.length){this.log.warn("No lessons selected");return}this.running=true,this.status(`Running (${t.length})`),this.log.banner("Start",`${t.length} items`),this.log.toast(`Auto Watch: Start ${t.length} item(s)`,{type:"info"});for(const e of t){if(!this.running)break;try{await this.playIndex(e);}catch(s){this.log.warn("playIndex error",e,s);}}this.stop();}scanLessons(){const t=Array.from(document.querySelectorAll(".logs-list .content-box section")),e=new Set,s=[];let n=0,o=0;const d=r=>r.trim().replace(/\s+/g," ").slice(0,200),i=r=>{try{const h=r.querySelector("a[href]");if(!h)return "";const u=h.getAttribute("href")||"";return u.split("#")[0].split("?")[0]||u}catch{return ""}};return t.forEach((r,h)=>{const u=this.detectType(r);if(u!=="shipin")return;n++;const p=d(r.querySelector(".title")?.textContent||r.textContent||""),m=i(r),y=m?`href:${m}`:`title:${p}|type:${u}`;if(e.has(y)){o++;return}e.add(y),s.push({index:h,title:p,type:u});}),this.log.info("scanLessons:",{totalSections:t.length,shipin:n,unique:s.length,dups:o}),this.log.toast(`Scan: sections ${t.length}, video ${n}, unique ${s.length}`,{type:"info"}),s}lessonElements(){return Array.from(document.querySelectorAll(".logs-list .content-box section"))}getLessonByIndex(t){return this.lessonElements()[t]||null}detectType(t){if(!t)return "unknown";try{const s=t.querySelector("use")?.getAttribute("xlink:href")||"";return s.includes("shipin")?"shipin":s.includes("piliang")?"piliang":s.includes("kejian")?"kejian":s.includes("ketang")?"ketang":"unknown"}catch{return "unknown"}}observePauseOnce(){try{const t=document.getElementsByClassName("play-btn-tip")[0];if(!t)return;this.observer?.disconnect();const e=new MutationObserver(()=>{(t.innerText||"").includes("播放")&&(document.querySelector("video")?.play?.(),this.log.info("auto-resume"),this.log.toast("Auto-resume playback",{type:"info"}));});e.observe(t,{childList:!0}),this.observer=e;}catch{}}applySpeedAndMute(){try{const t=this.rate,e=document.getElementsByTagName("xt-speedbutton")[0],s=document.getElementsByTagName("xt-speedlist")[0],n=s?.firstElementChild?.firstElementChild;if(e&&s&&n){n.setAttribute("data-speed",String(t)),n.setAttribute("keyt",t+".00"),n.textContent=t+".00X";const o=document.createEvent("MouseEvent");o.initMouseEvent("mousemove",!0,!0,window,0,10,10,10,10,0,0,0,0,0,null),e.dispatchEvent(o),n.click(),this.log.info("speed set",t);}}catch{}for(const t of Array.from(document.querySelectorAll("video")))try{t.play(),t.playbackRate=this.rate,t.volume=0;}catch{}for(const t of Array.from(document.querySelectorAll("audio")))try{t.play(),t.playbackRate=this.rate,t.volume=0;}catch{}try{document.querySelector("#video-box > div > xt-wrap > xt-controls > xt-inner > xt-volumebutton > xt-icon")?.click();}catch{}this.observePauseOnce(),this.log.toast(`Playback: ${this.rate}x · muted`,{type:"info"});}async waitProgressDone(t=900*1e3){const e=Date.now();for(;Date.now()-e<t&&this.running;){try{const o=document.querySelector(".progress-wrap .text")?.innerText||"";if(/(100%|99%|98%|已完成)/.test(o))return !0}catch{}const s=document.querySelector("video");if(s&&s.ended)return  true;await v(1e3);}return  false}async playIndex(t){this.status(`Playing #${t+1}`);const e=this.getLessonByIndex(t);if(!e){this.log.warn("lesson not found",t);return}e.scrollIntoView({behavior:"smooth",block:"center"}),await v(600);const s=this.detectType(e);if(this.log.info("open",t+1,s),this.log.toast(`Open #${t+1} (${s})`,{type:"info"}),e.click(),await v(2500),s==="shipin"){this.applySpeedAndMute();const n=await this.waitProgressDone();this.log[n?"success":"warn"]("video done?",n),this.log.toast(`#${t+1} ${n?"Completed":"Not fully completed (timeout?)"}`,{type:n?"success":"warn"}),history.back(),await v(1500);return}this.log.info("skip unknown type");}}function x(g){return g?g.includes("已完成")?"已完成":g.includes("未完成")?"未完成":g.includes("进行中")?"进行中":null:null}class C{el;statusEl;listWrap;rateSel;filterMode="all";selected=new Set;lessons=[];player=new E({onStatus:t=>this.setStatus(t),rate:2});constructor(){const t=document.createElement("div");t.className="cjai-section";const e=document.createElement("div");e.className="cjai-section__title",e.textContent="YukeTang Auto Watch";const s=document.createElement("div");s.className="cjai-section__description",s.textContent="选择需要自动播放的课节，仅支持当前课程页（/v2/web）。";const n=document.createElement("div");n.style.display="flex",n.style.gap="8px",n.style.flexWrap="wrap",n.style.alignItems="center";const o=document.createElement("select");o.className="cjai-btn";for(const a of [1,1.25,1.5,2,3,5,10]){const c=document.createElement("option");c.value=String(a),c.textContent=`${a}x`,a===2&&(c.selected=true),o.appendChild(c);}const d=document.createElement("button");d.className="cjai-btn",d.textContent="Scan Lessons";const i=document.createElement("button");i.className="cjai-btn",i.textContent="Select Incomplete";const r=document.createElement("button");r.className="cjai-btn",r.textContent="Select All";const h=document.createElement("button");h.className="cjai-btn",h.textContent="Select None";const u=document.createElement("button");u.className="cjai-btn cjai-btn--primary",u.textContent="Start Selected";const p=document.createElement("button");p.className="cjai-btn cjai-btn--danger",p.textContent="Stop";const m=document.createElement("div");m.style.marginLeft="auto",m.style.fontSize="12px",m.style.color="var(--cjai-ink-muted)";const y=document.createElement("select");y.className="cjai-btn";const S=[["All","all"],["Incomplete","incomplete"],["Completed","completed"]];for(const[a,c]of S){const v=document.createElement("option");v.value=c,v.textContent=a,y.appendChild(v);}n.append(o,d,y,r,h,i,u,p,m);const f=document.createElement("div");f.style.marginTop="8px",f.style.overflow="auto",f.style.border="1px dashed var(--cjai-border)",f.style.borderRadius="8px",f.style.padding="6px",f.style.background="var(--cjai-bg)",t.append(e,s,n,f),o.addEventListener("change",()=>{this.player.setRate(Number(o.value)),C$1.info("YKT: rate ->",o.value),C$1.toast(`YKT: rate -> ${o.value}x`,{type:"info"});}),y.addEventListener("change",()=>{this.filterMode=y.value;const a=this.filterMode==="incomplete"?"Incomplete":this.filterMode==="completed"?"Completed":"All";this.renderList(),C$1.toast(`YKT: filter -> ${a}`,{type:"info"});}),d.addEventListener("click",()=>this.scan()),i.addEventListener("click",()=>{this.selected.clear();for(const a of this.lessons){const c=x(a.title);(c==="未完成"||c==="进行中")&&this.selected.add(a.index);}this.renderList(),C$1.toast(`YKT: selected ${this.selected.size} incomplete`,{type:"info"});}),r.addEventListener("click",()=>{this.selected.clear();for(const a of this.lessons)this.selected.add(a.index);this.renderList(),C$1.toast(`YKT: selected all ${this.selected.size}`,{type:"info"});}),h.addEventListener("click",()=>{this.selected.clear(),this.renderList(),C$1.toast("YKT: selected none",{type:"info"});}),u.addEventListener("click",async()=>{const a=Array.from(this.selected.values()).sort((c,v)=>c-v);C$1.toast(`YKT: start ${a.length} @ ${this.rateSel.value}x`,{type:"info"}),await this.player.start(a);}),p.addEventListener("click",()=>{C$1.toast("YKT: stop requested",{type:"warn"}),this.player.stop();});const w=window.CJAI||(window.CJAI={});w.ykt={scan:()=>(this.scan(),this.lessons.map(a=>({index:a.index,type:a.type,title:a.title}))),start:(a,c)=>(c!=null&&this.player.setRate(c),this.player.start(a)),stop:()=>this.player.stop()},this.el=t,this.statusEl=m,this.listWrap=f,this.rateSel=o;}setStatus(t){this.statusEl.textContent=t;}renderList(){if(this.listWrap.innerHTML="",!this.lessons.length){const t=document.createElement("div");t.style.fontSize="12px",t.style.color="var(--cjai-ink-muted)",t.textContent="未发现课节，请在课程目录页（/v2/web）点击 Scan Lessons。",this.listWrap.appendChild(t),this.setStatus("");return}for(const t of this.lessons){const e=x(t.title);if(this.filterMode==="incomplete"&&e==="已完成"||this.filterMode==="completed"&&e!=="已完成")continue;const s=document.createElement("div");s.className="cjai-row cjai-row--clickable";const n=document.createElement("label");n.className="cjai-check";const o=document.createElement("input");o.type="checkbox",o.checked=this.selected.has(t.index);const d=document.createElement("span");if(d.textContent=`#${t.index+1} · ${t.title}`,e){const i=document.createElement("span");i.textContent=` ${e}`,i.style.marginLeft="6px",i.style.padding="0 6px",i.style.borderRadius="10px",i.style.fontSize="12px",i.style.lineHeight="18px",i.style.border="1px solid var(--cjai-border)",i.style.background="var(--cjai-bg)",e==="已完成"&&(i.style.color="var(--cjai-ink-muted)"),e==="未完成"&&(i.style.color="var(--cjai-danger, #d84a4a)"),e==="进行中"&&(i.style.color="var(--cjai-warning, #d89614)"),d.appendChild(i);}e==="已完成"&&(s.style.opacity="0.65",d.style.color="var(--cjai-ink-muted)"),s.dataset.selected=String(o.checked),o.addEventListener("change",()=>{o.checked?this.selected.add(t.index):this.selected.delete(t.index),s.dataset.selected=String(o.checked),this.setStatus(`${this.selected.size} selected`);}),s.addEventListener("click",i=>{i.target.tagName.toLowerCase()!=="input"&&(o.checked=!o.checked,o.dispatchEvent(new Event("change")));}),n.append(o,d),s.append(n),this.listWrap.appendChild(s);}this.setStatus(`${this.selected.size} selected`);}scan(){try{this.lessons=this.player.scanLessons(),this.selected.clear();for(const t of this.lessons){const e=x(t.title);(e==="未完成"||e==="进行中")&&this.selected.add(t.index);}this.renderList(),C$1.toast(`YKT: scanned (shipin only) ${this.lessons.length}`,{type:"success"}),C$1.toast(`YKT: auto-selected ${this.selected.size} (未完成/进行中)`,{type:"info"}),C$1.success("YKT: scanned (shipin only)",this.lessons.length);}catch(t){C$1.error("YKT: scan failed",t),C$1.toast("YKT: scan failed (see console)",{type:"error"});}}} exports("default", C);

		})
	};
}));

System.register("./wait-CYghtssh-DEyvWMVm.js", [], (function (exports, module) {
	'use strict';
	return {
		execute: (function () {

			exports({
				R: R,
				T: T,
				j: j,
				v: v
			});

			const w={silent:0,error:1,warn:2,info:3,debug:4,trace:5},h="CJ_AI_LOG_LEVEL",b="CJ-AI";let p=null,m=new Set;function j(r){p=r;}function T(r){m=new Set(r||[]);}const k=["background: linear-gradient(135deg, #2b6cb0, #3182ce)","color: #fff","padding: 2px 8px","border-radius: 999px 0 0 999px","font-weight: 700","font-family: ui-sans-serif, -apple-system, system-ui, Segoe UI, Roboto"].join(";"),$={error:["background: #c53030","color: #fff","padding: 2px 8px","border-radius: 0 999px 999px 0","font-weight: 700"].join(";"),warn:["background: #b7791f","color: #fff","padding: 2px 8px","border-radius: 0 999px 999px 0","font-weight: 700"].join(";"),info:["background: #2c5282","color: #fff","padding: 2px 8px","border-radius: 0 999px 999px 0","font-weight: 700"].join(";"),debug:["background: #4a5568","color: #fff","padding: 2px 8px","border-radius: 0 999px 999px 0","font-weight: 700"].join(";"),trace:["background: #1a202c","color: #fff","padding: 2px 8px","border-radius: 0 999px 999px 0","font-weight: 700"].join(";"),success:["background: #2f855a","color: #fff","padding: 2px 8px","border-radius: 0 999px 999px 0","font-weight: 700"].join(";")};function E(){const r=typeof localStorage<"u"&&localStorage.getItem(h)||"";return r&&r in w?r:"debug"}function L(r){try{typeof localStorage<"u"&&localStorage.setItem(h,r);}catch{}}function g(r,t){const d=t?`:${t}`:"";return [`%c ${b}${d} %c ${r.toUpperCase()} `,k,$[r],""]}function f(r,t){return w[r]>=w[t]}function y(r){let t=E();const d=e=>{try{const n=e.map(o=>{if(typeof o=="string")return o;if(o instanceof Error)return o.message;try{return JSON.stringify(o)}catch{return String(o)}}).join(" ");return n.length>220?n.slice(0,217)+"...":n}catch{return ""}},a=(e,n)=>(...o)=>{if(!f(t,e))return;const[s,c,i,l]=g(n==="success"?"success":e,r),u=console;switch(n){case "error":u.error(s,c,i,l,...o);break;case "warn":u.warn(s,c,i,l,...o);break;case "debug":u.debug(s,c,i,l,...o);break;case "trace":u.trace(s,c,i,l,...o);break;case "success":u.log(s,c,i,l,...o);break;default:u.log(s,c,i,l,...o);}if(p){const x=n==="error"?"error":n==="warn"?"warn":n==="success"?"success":e==="info"?"info":null;if(x&&m.has(x))try{p(d(o),{type:x});}catch{}}};return {level:()=>t,setLevel:e=>{t=e,L(e);},error:a("error","error"),warn:a("warn","warn"),info:a("info","log"),debug:a("debug","debug"),trace:a("trace","trace"),success:a("info","success"),toast:(e,n)=>{if(p)try{p(e,n);}catch{}},group:e=>{if(!f(t,"info"))return;const[n,o,s,c]=g("info",r);e?console.group(n+" %c"+e,o,s,c,""):console.group(n,o,s,c);},groupCollapsed:e=>{if(!f(t,"info"))return;const[n,o,s,c]=g("info",r);e?console.groupCollapsed(n+" %c"+e,o,s,c,""):console.groupCollapsed(n,o,s,c);},groupEnd:()=>{console.groupEnd();},time:(e="time")=>{f(t,"debug")&&console.time(`${b}${r?":"+r:""}:${e}`);},timeEnd:(e="time")=>{f(t,"debug")&&console.timeEnd(`${b}${r?":"+r:""}:${e}`);},table:(e,n)=>{if(!f(t,"debug"))return;const[o,s,c,i]=g("debug",r);typeof console.table=="function"?(console.log(o,s,c,i),console.table(e,n)):console.log(o,s,c,i,e);},assert:(e,...n)=>{if(!f(t,"warn"))return;const[o,s,c,i]=g("warn",r);console.assert(e??false,o,s,c,i,...n);},banner:(e,n)=>{if(!f(t,"info"))return;const o="background:#2b6cb0;color:white;padding:2px 8px;border-radius:8px 0 0 8px;font-weight:700;",s="background:#1a202c;color:#fff;padding:2px 8px;border-radius:0 8px 8px 0;font-weight:600;",c=`%c ${b} %c ${e}${n?" — "+n:""}`;console.log(c,o,s);},withScope:e=>y(r?`${r}:${e}`:e)}}const C$1=exports("C", y());function v(r){return new Promise(t=>setTimeout(t,r))}async function R(r,t={}){const{timeoutMs:d=1e4,intervalMs:a=100,signal:S}=t,e=Date.now();for(;;){if(S?.aborted)return  false;if(await r())return  true;if(Date.now()-e>d)return  false;await v(a);}}

		})
	};
}));

System.import("./__entry.js", "./");